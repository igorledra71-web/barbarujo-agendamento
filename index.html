<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Barbarujo Agenda Pro</title>

<style>

body{
margin:0;
background:#0b0b0b;
color:#f2f2f2;
font-family:Arial, Helvetica, sans-serif;
}

header{
background:#000;
padding:22px;
text-align:center;
border-bottom:3px solid #caa63a;
}

header h1{
margin:0;
letter-spacing:2px;
}

.card{
background:#161616;
margin:15px;
padding:20px;
border-radius:14px;
border:1px solid #2a2a2a;
box-shadow:0 10px 30px rgba(0,0,0,0.6);
}

h2{
margin-top:0;
color:#e7c15a;
}

label{
font-size:13px;
opacity:0.9;
}

input,select{
width:100%;
padding:12px;
margin:6px 0 14px 0;
border-radius:8px;
border:1px solid #333;
background:#101010;
color:white;
}

button{
width:100%;
padding:14px;
border-radius:10px;
border:none;
background:#caa63a;
color:black;
font-weight:bold;
cursor:pointer;
margin-top:6px;
}

button:hover{
opacity:0.9;
transform:translateY(-1px);
}

.hidden{
display:none;
}

#horarios{
display:grid;
grid-template-columns:repeat(3,1fr);
gap:8px;
}

.hora{
background:#1f1f1f;
padding:12px;
text-align:center;
border-radius:8px;
cursor:pointer;
border:1px solid #333;
}

.hora.sel{
background:#e7c15a;
color:black;
font-weight:bold;
}

.hora.ocupado{
background:#5a1a1a;
opacity:0.6;
cursor:not-allowed;
}

.item{
background:#121212;
padding:10px;
border-radius:8px;
margin:6px 0;
border:1px solid #2a2a2a;
}

.adminBtn{
position:fixed;
bottom:10px;
right:10px;
opacity:0.15;
font-size:22px;
cursor:pointer;
}

</style>
</head>
<body>

<header>
<h1>BARBARUJO AGENDA PRO</h1>
</header>
<!-- LOGIN CLIENTE -->

<div class="card" id="loginBox">
<h2>Entrar</h2>

<label>Nome</label>
<input id="cliNome">

<label>WhatsApp</label>
<input id="cliTel">

<button onclick="loginCliente()">Entrar</button>
</div>


<!-- ÁREA CLIENTE -->

<div id="areaCliente" class="hidden">

<div class="card">
<h2>Novo Agendamento</h2>

<label>Barbeiro</label>
<select id="barbeiro"></select>

<label>Serviço</label>
<select id="servico"></select>

<label>Data</label>
<input type="date" id="data">

<label>Horário</label>
<div id="horarios"></div>

<button onclick="confirmarAgendamento()">Confirmar</button>
</div>


<div class="card">
<h2>Meus Agendamentos</h2>
<div id="listaMeus"></div>
</div>

</div>


<!-- BOTÃO ADMIN ESCONDIDO -->

<div class="adminBtn" onclick="abrirAdmin()">⚙</div>


<!-- LOGIN ADMIN -->

<div class="card hidden" id="adminLogin">
<h2>Painel Admin</h2>
<input type="password" id="adminSenha" placeholder="Senha">
<button onclick="loginAdmin()">Entrar</button>
</div>


<!-- PAINEL ADMIN -->

<div id="adminArea" class="hidden">

<div class="card">
<h2>Configuração</h2>

<label>Limite encaixe por horário</label>
<input id="cfgLimite" value="2">

<button onclick="salvarConfig()">Salvar Config</button>
</div>


<div class="card">
<h2>Barbeiros</h2>

<input id="novoBarbeiro" placeholder="Nome barbeiro">
<button onclick="addBarbeiro()">Adicionar</button>

<div id="listaBarbeiros"></div>
</div>


<div class="card">
<h2>Serviços</h2>

<input id="novoServico" placeholder="Nome serviço">
<button onclick="addServico()">Adicionar</button>

<div id="listaServicos"></div>
</div>


<div class="card">
<h2>Agenda Geral</h2>
<div id="agendaAdmin"></div>
</div>

</div>
<script>

// ===== BANCO LOCAL =====

function dbGet(chave, padrao){
return JSON.parse(localStorage.getItem(chave) || JSON.stringify(padrao));
}

function dbSet(chave, valor){
localStorage.setItem(chave, JSON.stringify(valor));
}


// ===== DADOS INICIAIS =====

if(!localStorage.getItem("barbeiros")){
dbSet("barbeiros", ["Carlos","João"]);
}

if(!localStorage.getItem("servicos")){
dbSet("servicos", ["Corte","Corte + Barba"]);
}

if(!localStorage.getItem("agendamentos")){
dbSet("agendamentos", []);
}

if(!localStorage.getItem("config")){
dbSet("config", {limite:2});
}


// ===== ESTADO =====

let horaSel = null;


// ===== LOGIN CLIENTE =====

function loginCliente(){

const nome = cliNome.value.trim();
const tel = cliTel.value.trim();

if(!nome || !tel){
alert("Preencha os dados");
return;
}

localStorage.setItem("clienteNome", nome);
localStorage.setItem("clienteTel", tel);

loginBox.classList.add("hidden");
areaCliente.classList.remove("hidden");

carregarSelects();
gerarHorarios();
listarMeus();
}


// ===== SELECTS =====

function carregarSelects(){

const barbeiros = dbGet("barbeiros",[]);
barbeiro.innerHTML = "";

barbeiros.forEach(b=>{
barbeiro.innerHTML += `<option>${b}</option>`;
});

const servicos = dbGet("servicos",[]);
servico.innerHTML = "";

servicos.forEach(s=>{
servico.innerHTML += `<option>${s}</option>`;
});
}

// ===== GERAR HORÁRIOS =====

function gerarHorarios(){

horaSel = null;
horarios.innerHTML = "";

for(let h=8; h<=20; h++){

["00","30"].forEach(m=>{

const hh = h.toString().padStart(2,"0");
const hora = hh + ":" + m;

horarios.innerHTML +=
`<div class="hora" data-h="${hora}">${hora}</div>`;

});

}

document.querySelectorAll(".hora").forEach(el=>{
el.onclick = ()=>selecionarHora(el);
});

atualizarOcupacaoVisual();
}


// ===== SELECIONAR HORA =====

function selecionarHora(el){

if(el.classList.contains("ocupado")){
return;
}

document.querySelectorAll(".hora")
.forEach(x=>x.classList.remove("sel"));

el.classList.add("sel");
horaSel = el.dataset.h;
}


// ===== OCUPAÇÃO VISUAL =====

function atualizarOcupacaoVisual(){

const dataSel = data.value;
if(!dataSel) return;

const lista = dbGet("agendamentos",[]);
const limite = dbGet("config",{}).limite || 2;

let mapa = {};

lista.forEach(a=>{
if(a.data === dataSel && a.status === "ativo"){
mapa[a.hora] = (mapa[a.hora] || 0) + 1;
}
});

document.querySelectorAll(".hora").forEach(el=>{

const h = el.dataset.h;
el.classList.remove("ocupado");

if(mapa[h] >= limite){
el.classList.add("ocupado");
}

});
}


// atualizar quando muda data
data.onchange = atualizarOcupacaoVisual;
// ===== CONFIRMAR AGENDAMENTO =====

function confirmarAgendamento(){

const dataSel = data.value;
const barb = barbeiro.value;
const serv = servico.value;
const nome = localStorage.getItem("clienteNome");
const tel = localStorage.getItem("clienteTel");

if(!dataSel || !horaSel){
alert("Escolha data e horário");
return;
}

const lista = dbGet("agendamentos",[]);
const limite = dbGet("config",{}).limite || 2;


// ===== LIMITE ENCAIXE =====

const qtdHora = lista.filter(a =>
a.data === dataSel &&
a.hora === horaSel &&
a.status === "ativo"
).length;

if(qtdHora >= limite){
alert("Horário lotado");
return;
}


// ===== BARBEIRO OCUPADO =====

const barbOcupado = lista.some(a =>
a.data === dataSel &&
a.hora === horaSel &&
a.barbeiro === barb &&
a.status === "ativo"
);

if(barbOcupado){
alert("Barbeiro ocupado nesse horário");
return;
}


// ===== SALVAR =====

lista.push({
id: Date.now(),
nome: nome,
tel: tel,
barbeiro: barb,
servico: serv,
data: dataSel,
hora: horaSel,
status: "ativo",
criado: Date.now()
});

dbSet("agendamentos", lista);

alert("Agendado com sucesso");

listarMeus();
atualizarOcupacaoVisual();
}
// ===== LISTAR MEUS AGENDAMENTOS =====

function listarMeus(){

const tel = localStorage.getItem("clienteTel");
const lista = dbGet("agendamentos",[]);

listaMeus.innerHTML = "";

lista
.filter(a => a.tel === tel && a.status === "ativo")
.forEach(a => {

listaMeus.innerHTML += `
<div class="item">
${a.data} ${a.hora} — ${a.servico} — ${a.barbeiro}
<button onclick="cancelarAg(${a.id})">Cancelar</button>
</div>
`;

});
}


// ===== CANCELAR =====

function cancelarAg(id){

let lista = dbGet("agendamentos",[]);

lista = lista.map(a => {
if(a.id === id){
a.status = "cancelado";
}
return a;
});

dbSet("agendamentos", lista);

listarMeus();
atualizarOcupacaoVisual();
}
// ===== ABRIR ADMIN =====

function abrirAdmin(){
adminLogin.classList.remove("hidden");
}


// ===== LOGIN ADMIN =====

function loginAdmin(){

if(adminSenha.value !== "1234"){
alert("Senha incorreta");
return;
}

adminLogin.classList.add("hidden");
adminArea.classList.remove("hidden");

carregarAdmin();
}


// ===== SALVAR CONFIG =====

function salvarConfig(){

const cfg = dbGet("config",{});
cfg.limite = parseInt(cfgLimite.value) || 2;

dbSet("config", cfg);

alert("Config salva");
atualizarOcupacaoVisual();
}


// ===== CARREGAR ADMIN =====

function carregarAdmin(){

listarBarbeirosAdmin();
listarServicosAdmin();
listarAgendaAdmin();

const cfg = dbGet("config",{});
cfgLimite.value = cfg.limite || 2;
}
// ===== BARBEIROS ADMIN =====

function addBarbeiro(){

const nome = novoBarbeiro.value.trim();
if(!nome) return;

const lista = dbGet("barbeiros",[]);
lista.push(nome);

dbSet("barbeiros", lista);

novoBarbeiro.value = "";

listarBarbeirosAdmin();
carregarSelects();
}


function listarBarbeirosAdmin(){

const lista = dbGet("barbeiros",[]);
listaBarbeiros.innerHTML = "";

lista.forEach((b,i)=>{
listaBarbeiros.innerHTML += `
<div class="item">
${b}
<button onclick="delBarbeiro(${i})">Excluir</button>
</div>
`;
});
}


function delBarbeiro(i){

const lista = dbGet("barbeiros",[]);
lista.splice(i,1);
dbSet("barbeiros", lista);

listarBarbeirosAdmin();
carregarSelects();
}


// ===== SERVIÇOS ADMIN =====

function addServico(){

const nome = novoServico.value.trim();
if(!nome) return;

const lista = dbGet("servicos",[]);
lista.push(nome);

dbSet("servicos", lista);

novoServico.value = "";

listarServicosAdmin();
carregarSelects();
}


function listarServicosAdmin(){

const lista = dbGet("servicos",[]);
listaServicos.innerHTML = "";

lista.forEach((s,i)=>{
listaServicos.innerHTML += `
<div class="item">
${s}
<button onclick="delServico(${i})">Excluir</button>
</div>
`;
});
}


function delServico(i){

const lista = dbGet("servicos",[]);
lista.splice(i,1);
dbSet("servicos", lista);

listarServicosAdmin();
carregarSelects();
}
// ===== AGENDA ADMIN =====

function listarAgendaAdmin(){

const lista = dbGet("agendamentos",[]);

agendaAdmin.innerHTML = "";

lista
.filter(a => a.status === "ativo")
.sort((a,b)=> (a.data + a.hora).localeCompare(b.data + b.hora))
.forEach(a => {

agendaAdmin.innerHTML += `
<div class="item">
${a.data} ${a.hora} — ${a.nome} — ${a.servico} — ${a.barbeiro}
</div>
`;

});
}



// ===== CANCELAMENTO AUTOMÁTICO (30 min sem confirmação) =====

setInterval(()=>{

let lista = dbGet("agendamentos",[]);
let mudou = false;

lista.forEach(a => {

if(a.status === "ativo"){

const diff = Date.now() - a.criado;

if(diff > 30 * 60 * 1000){
a.status = "cancelado_auto";
mudou = true;
}

}

});

if(mudou){
dbSet("agendamentos", lista);
atualizarOcupacaoVisual();
listarMeus();
}

},60000);



// ===== INIT =====

(function init(){

carregarSelects();

})();

</script>

</body>
</html>
