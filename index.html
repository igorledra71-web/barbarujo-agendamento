<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>BARBARUJO ‚Ä¢ Agendamento</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0e0e0e">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Poppins,sans-serif}
body{background:#0e0e0e;color:#fff}
header{background:#111;padding:20px;text-align:center;font-size:26px;font-weight:700;border-bottom:2px solid #222;cursor:pointer}

.container{max-width:960px;margin:auto;padding:20px;display:none}

.card{background:#181818;border-radius:16px;padding:20px;margin-bottom:18px;box-shadow:0 0 18px rgba(0,0,0,.35)}
h3{margin-bottom:12px}

.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px}

.btn{background:#d4af37;border:none;padding:14px;border-radius:12px;font-weight:700;width:100%;cursor:pointer;color:#000}
.btn-outline{background:transparent;border:2px solid #d4af37;color:#d4af37;padding:12px;border-radius:12px;width:100%;cursor:pointer}

button{-webkit-tap-highlight-color:transparent}

input,select{width:100%;padding:12px;border-radius:10px;border:none;margin-top:6px;color:#000}

.slot{background:#222;padding:12px;border-radius:10px;text-align:center;cursor:pointer;font-weight:700}
.slot.booked{background:#402020;opacity:.5;pointer-events:none}
.slot.selected{outline:3px solid #d4af37}

.badge{background:#d4af37;color:#000;padding:4px 8px;border-radius:8px;font-size:12px;font-weight:700}
.hidden{display:none}

/* ===== SPLASH ANIMADA ===== */

.splash{
position:fixed;
inset:0;
background:#0e0e0e;
display:flex;
flex-direction:column;
align-items:center;
justify-content:center;
z-index:9999;
padding:20px;
text-align:center;
animation:splashFade .6s ease;
}

@keyframes splashFade{
from{opacity:0}
to{opacity:1}
}

.splash-logo{
width:72vw;
max-width:460px;
min-width:240px;
margin-bottom:26px;
border-radius:26px;
box-shadow:0 0 40px rgba(0,0,0,.7);
animation:logoPop .9s ease;
position:relative;
}

@keyframes logoPop{
0%{transform:scale(.7);opacity:0}
100%{transform:scale(1);opacity:1}
}

.splash-titulo{
font-size:clamp(28px,5vw,42px);
margin-bottom:18px;
opacity:0;
animation:titleFade .6s ease .5s forwards;
}

@keyframes titleFade{
to{opacity:1}
}

.splash-btn{
max-width:340px;
font-size:18px;
padding:16px;
opacity:0;
animation:btnFade .6s ease 1.1s forwards;
}

@keyframes btnFade{
to{opacity:1}
}

</style>
</head>

<body>

<!-- SPLASH -->

<div id="telaSplash" class="splash">

<img src="logo.png" class="splash-logo">

<h1 class="splash-titulo">üíà BARBARUJO</h1>

<button id="btnEntrar" class="btn splash-btn">
Agende seu hor√°rio
</button>

</div>

<header id="topo">üíà BARBARUJO</header>

<div class="container">
<!-- ================= CLIENTE ================= -->

<div id="telaCliente">

<div class="card">
<h3>Escolha o servi√ßo</h3>
<div id="listaServicos" class="grid"></div>
</div>

<div id="cardBarbeiro" class="card hidden">
<h3>Escolha o barbeiro</h3>
<div id="listaBarbeiros" class="grid"></div>
</div>

<div id="cardData" class="card hidden">
<h3>Escolha o dia dispon√≠vel</h3>
<select id="dataEscolhida"></select>
</div>

<div id="cardHorarios" class="card hidden">
<h3>Escolha o hor√°rio dispon√≠vel</h3>
<div id="listaHorarios" class="grid"></div>
</div>

<div id="cardCliente" class="card hidden">

<h3>Resumo da reserva</h3>
<div id="resumoEscolha"></div>

<input id="clienteNome" placeholder="Nome">
<input id="clienteFone" placeholder="WhatsApp">

<button id="btnReservar" class="btn">
Reservar hor√°rio
</button>

<button id="btnConfirmar" class="btn-outline hidden">
Confirmar agendamento
</button>

</div>

</div>

<!-- ================= ADMIN ================= -->

<div id="telaAdmin" class="hidden">

<div class="card">
<h3>Painel Administrador</h3>
<button id="btnLogout" class="btn-outline">Sair</button>
</div>

<div class="card">
<h3>Servi√ßos</h3>
<input id="novoServicoNome" placeholder="Nome">
<input id="novoServicoPreco" placeholder="Pre√ßo">
<button id="btnAddServico" class="btn">Adicionar</button>
<div id="adminServicos"></div>
</div>

<div class="card">
<h3>Barbeiros</h3>
<input id="novoBarbeiro" placeholder="Nome">
<button id="btnAddBarbeiro" class="btn">Adicionar</button>
<div id="adminBarbeiros"></div>
</div>

<div class="card">
<h3>Funcionamento base</h3>

<label>Abertura</label>
<input type="time" id="cfgAbertura">

<label>Fechamento</label>
<input type="time" id="cfgFechamento">

<label>Intervalo (minutos)</label>
<select id="cfgIntervalo">
<option value="15">15</option>
<option value="30">30</option>
<option value="45">45</option>
<option value="60">60</option>
</select>

<button id="btnSalvarCfg" class="btn">
Salvar base de hor√°rios
</button>

</div>

<div class="card">
<h3>Disponibilidade por data</h3>

<input type="date" id="adminDataPick">

<button id="btnGerarSlots" class="btn">
Gerar hor√°rios do dia
</button>

<div id="adminSlotsGrid" class="grid"></div>

<button id="btnSalvarSlotsDia" class="btn">
Salvar disponibilidade do dia
</button>

<button id="btnResetDia" class="btn-outline">
Resetar hor√°rios do dia
</button>

</div>

<div class="card">
<h3>Ferramentas</h3>

<button id="btnExportarDia" class="btn">
Copiar agenda do dia
</button>

<button id="btnSetup" class="btn">
Setup r√°pido
</button>

<button id="btnDemo" class="btn">
Modo demonstra√ß√£o
</button>

<button id="btnInstalarApp" class="btn">
Instalar como app
</button>

</div>

<div class="card">
<h3>Agendamentos</h3>
<div id="listaAgendamentos"></div>
</div>

</div>
<!-- ================= FIREBASE ================= -->

<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>

<script>

// ===== CONFIG FIREBASE ‚Äî BARBARUJO =====

const firebaseConfig = {
apiKey: "AIzaSyBDffb23AqSOoT-8Z94Ao9leB5nTSdIv78",
authDomain: "agenda-barbarujo.firebaseapp.com",
databaseURL: "https://agenda-barbarujo-default-rtdb.firebaseio.com/",
projectId: "agenda-barbarujo",
storageBucket: "agenda-barbarujo.firebasestorage.app",
messagingSenderId: "735138068544",
appId: "1:735138068544:web:5a1273bd8be9ef7ab487a5"
}

// ===== INIT FIREBASE =====

firebase.initializeApp(firebaseConfig)

const db = firebase.database()

// ===== REFER√äNCIAS DE DADOS =====

const DB = {
servicos: db.ref("barbarujo/servicos"),
barbeiros: db.ref("barbarujo/barbeiros"),
config: db.ref("barbarujo/config"),
ag: db.ref("barbarujo/agendamentos"),
dispDia: db.ref("barbarujo/disponibilidade_por_dia")
}

</script>
<script>

// =========================
// ESTADO GLOBAL
// =========================

let servicos=[]
let barbeiros=[]
let agendamentos=[]
let disponibilidade={} // { data: [horarios] }

let config={
abertura:"08:00",
fechamento:"18:00",
intervalo:30
}

let servicoSel=null
let barbeiroSel=null
let dataSel=null
let horaSel=null

let salvando=false

let escolhaStatus={
servico:false,
barbeiro:false,
data:false,
hora:false
}

// =========================
// WHITE LABEL
// =========================

let NOME_BARBEARIA="BARBARUJO"
let WHATS_BARBEARIA="5599999999999"

const ADMIN_SENHA="barbarujo123"

// =========================
// HELPERS
// =========================

function hojeISO(){
return new Date().toISOString().split("T")[0]
}

// =========================
// M√ÅSCARA TELEFONE
// =========================

clienteFone.addEventListener("input",()=>{
clienteFone.value=
clienteFone.value.replace(/\D/g,"").slice(0,11)
})

// =========================
// SPLASH ‚Äî ENTRAR
// =========================

btnEntrar.onclick=()=>{

telaSplash.style.opacity="0"
telaSplash.style.transition="opacity .4s"

setTimeout(()=>{
telaSplash.style.display="none"
document.querySelector(".container").style.display="block"
},400)

}

// =========================
// NOME DIN√ÇMICO
// =========================

function aplicarNome(){
topo.innerText="üíà "+NOME_BARBEARIA
document.title=NOME_BARBEARIA+" ‚Ä¢ Agendamento"
}
aplicarNome()

// =========================
// ADMIN ‚Äî TOUCH + DESKTOP
// =========================

let pressTimer

topo.addEventListener("touchstart",()=>{
pressTimer=setTimeout(()=>abrirAdmin(),2000)
})

topo.addEventListener("touchend",()=>{
clearTimeout(pressTimer)
})

topo.addEventListener("dblclick",abrirAdmin)

function abrirAdmin(){
let s=prompt("Senha admin")
if(s===ADMIN_SENHA){
telaCliente.classList.add("hidden")
telaAdmin.classList.remove("hidden")
}
}

btnLogout.onclick=()=>{
telaAdmin.classList.add("hidden")
telaCliente.classList.remove("hidden")
}

// =========================
// PWA INSTALL CONTROL
// =========================

let deferredPrompt=null

window.addEventListener("beforeinstallprompt",e=>{
e.preventDefault()
deferredPrompt=e
})

btnInstalarApp.onclick=()=>{
if(deferredPrompt){
deferredPrompt.prompt()
}
}

</script>
<script>

// =========================
// RENDER SERVI√áOS CLIENTE
// =========================

function renderServicos(){

listaServicos.innerHTML=""

servicos.forEach(s=>{

let b=document.createElement("button")
b.className="btn"
b.innerHTML=`${s.nome}<br><span class="badge">R$ ${s.preco}</span>`

b.onclick=()=>{
servicoSel=s
escolhaStatus.servico=true

cardBarbeiro.classList.remove("hidden")
renderBarbeiros()
atualizarResumo()
}

listaServicos.appendChild(b)

})

}

// =========================
// RENDER BARBEIROS CLIENTE
// =========================

function renderBarbeiros(){

listaBarbeiros.innerHTML=""

barbeiros.forEach(nome=>{

let b=document.createElement("button")
b.className="btn-outline"
b.innerText=nome

b.onclick=()=>{
barbeiroSel=nome
escolhaStatus.barbeiro=true

cardData.classList.remove("hidden")
renderDatasCliente()
atualizarResumo()
}

listaBarbeiros.appendChild(b)

})

}

// =========================
// RENDER DATAS DISPON√çVEIS CLIENTE
// =========================

function renderDatasCliente(){

dataEscolhida.innerHTML=""

let datas = Object.keys(disponibilidade).sort()

if(datas.length===0){
let opt=document.createElement("option")
opt.textContent="Sem dias liberados ainda"
dataEscolhida.appendChild(opt)
return
}

datas.forEach(d=>{
let opt=document.createElement("option")
opt.value=d
opt.textContent=d
dataEscolhida.appendChild(opt)
})

}

// =========================
// RESUMO ESCOLHA
// =========================

function atualizarResumo(){

resumoEscolha.innerHTML=`
<span class="badge">Servi√ßo</span> ${servicoSel?.nome||"-"}<br>
<span class="badge">Barbeiro</span> ${barbeiroSel||"-"}<br>
<span class="badge">Data</span> ${dataSel||"-"}<br>
<span class="badge">Hora</span> ${horaSel||"-"}
`

}

// =========================
// RENDER ADMIN SERVI√áOS
// =========================

function renderAdminServicos(){

adminServicos.innerHTML=""

servicos.forEach((s,i)=>{

let div=document.createElement("div")
div.className="card"

div.innerHTML=`
<b>${s.nome}</b> ‚Äî R$ ${s.preco}
<br><br>
<button class="btn-outline" onclick="removerServico(${i})">
Remover
</button>
`

adminServicos.appendChild(div)

})

}

// =========================
// RENDER ADMIN BARBEIROS
// =========================

function renderAdminBarbeiros(){

adminBarbeiros.innerHTML=""

barbeiros.forEach((b,i)=>{

let div=document.createElement("div")
div.className="card"

div.innerHTML=`
<b>${b}</b>
<br><br>
<button class="btn-outline" onclick="removerBarbeiro(${i})">
Remover
</button>
`

adminBarbeiros.appendChild(div)

})

}

// =========================
// RENDER ADMIN AGENDAMENTOS
// =========================

function renderAdminAgendamentos(){

listaAgendamentos.innerHTML=""

agendamentos
.sort((a,b)=>(a.data+a.hora).localeCompare(b.data+b.hora))
.forEach(a=>{

let div=document.createElement("div")
div.className="card"

div.innerHTML=`
<span class="badge">${a.data} ${a.hora}</span>
<br><br>
${a.servico} ‚Äî ${a.barbeiro}
<br>
Cliente: ${a.cliente}
<br>
WhatsApp: ${a.fone}
`

listaAgendamentos.appendChild(div)

})

}

</script>
<script>

// =========================
// ADMIN ‚Äî GERAR SLOTS POR DATA
// =========================

btnGerarSlots.onclick = ()=>{

let data = adminDataPick.value

if(!data){
alert("Escolha a data")
return
}

// hor√°rios j√° salvos
let ja = disponibilidade[data] || []

let [ha,ma] = config.abertura.split(":").map(Number)
let [hf,mf] = config.fechamento.split(":").map(Number)

let ini = ha*60 + ma
let fim = hf*60 + mf
let intervalo = Number(config.intervalo)

adminSlotsGrid.innerHTML=""

for(let t=ini; t<fim; t+=intervalo){

let h=Math.floor(t/60).toString().padStart(2,"0")
let m=(t%60).toString().padStart(2,"0")
let hora=h+":"+m

let div=document.createElement("div")
div.className="slot"
div.innerText=hora

// se j√° estava salvo, j√° marca
if(ja.includes(hora)){
div.classList.add("selected")
}

// toggle sele√ß√£o
div.onclick=()=>{
div.classList.toggle("selected")
}

adminSlotsGrid.appendChild(div)

}

}

// =========================
// ADMIN ‚Äî SALVAR DISPONIBILIDADE DO DIA
// =========================

btnSalvarSlotsDia.onclick = ()=>{

let data = adminDataPick.value

if(!data){
alert("Escolha a data")
return
}

let selecionados=[]

document
.querySelectorAll("#adminSlotsGrid .slot.selected")
.forEach(s=>selecionados.push(s.innerText))

if(selecionados.length===0){
alert("Selecione pelo menos um hor√°rio dispon√≠vel")
return
}

DB.dispDia.child(data).set(selecionados)

alert("Disponibilidade do dia salva ‚úÖ")

}

// =========================
// ADMIN ‚Äî RESETAR DIA
// =========================

btnResetDia.onclick = ()=>{

let data = adminDataPick.value

if(!data){
alert("Escolha a data")
return
}

DB.dispDia.child(data).remove()
adminSlotsGrid.innerHTML=""

alert("Hor√°rios do dia resetados ‚úÖ")

}

// =========================
// SYNC DISPONIBILIDADE FIREBASE
// =========================

DB.dispDia.on("value",snap=>{
disponibilidade = snap.exists()? snap.val() : {}
renderDatasCliente()
})

</script>
<script>

// =========================
// CLIENTE ‚Äî DATA SELECIONADA
// =========================

dataEscolhida.onchange = ()=>{

dataSel = dataEscolhida.value
escolhaStatus.data = true

if(!dataSel){
cardHorarios.classList.add("hidden")
return
}

renderHorariosCliente()
cardHorarios.classList.remove("hidden")
atualizarResumo()

}

// =========================
// CLIENTE ‚Äî RENDER HOR√ÅRIOS DISPON√çVEIS
// =========================

function renderHorariosCliente(){

listaHorarios.innerHTML=""
horaSel = null
escolhaStatus.hora = false

let lista = disponibilidade[dataSel] || []

lista.forEach(hora=>{

let div=document.createElement("div")
div.className="slot"
div.innerText=hora

// ===== BLOQUEIO POR BARBEIRO =====

let ocupado = agendamentos.find(a=>
a.data === dataSel &&
a.hora === hora &&
a.barbeiro === barbeiroSel
)

if(ocupado){
div.classList.add("booked")
}

// ===== SELE√á√ÉO =====

div.onclick = ()=>{

if(div.classList.contains("booked")) return

document
.querySelectorAll("#listaHorarios .slot")
.forEach(s=>s.classList.remove("selected"))

div.classList.add("selected")

horaSel = hora
escolhaStatus.hora = true

cardCliente.classList.remove("hidden")
atualizarResumo()

}

listaHorarios.appendChild(div)

})

}

// =========================
// CLIENTE ‚Äî BOT√ÉO RESERVAR
// =========================

btnReservar.onclick = ()=>{

if(!escolhaStatus.servico ||
   !escolhaStatus.barbeiro ||
   !escolhaStatus.data ||
   !escolhaStatus.hora){
alert("Complete servi√ßo, barbeiro, data e hor√°rio")
return
}

if(!clienteNome.value || !clienteFone.value){
alert("Preencha nome e WhatsApp")
return
}

alert("Hor√°rio reservado ‚Äî confirme abaixo para finalizar")

btnReservar.classList.add("hidden")
btnConfirmar.classList.remove("hidden")

}

// =========================
// AUTO REFRESH HOR√ÅRIOS
// =========================

DB.ag.on("value",()=>{
if(dataSel && !cardHorarios.classList.contains("hidden")){
renderHorariosCliente()
}
})

</script>
<script>

// =========================
// WHATSAPP CONFIRMA√á√ÉO
// =========================

function enviarWhatsConfirmacao(ag){

let msg =
`üíà ${NOME_BARBEARIA}
Agendamento confirmado

Servi√ßo: ${ag.servico}
Barbeiro: ${ag.barbeiro}
Data: ${ag.data}
Hora: ${ag.hora}

At√© breve!`

let url =
"https://wa.me/55"+
ag.fone.replace(/\D/g,"")+
"?text="+encodeURIComponent(msg)

window.open(url,"_blank")

}

// =========================
// CONFIRMAR AGENDAMENTO
// =========================

btnConfirmar.onclick = async ()=>{

if(salvando) return
salvando = true

if(!servicoSel || !barbeiroSel || !dataSel || !horaSel){
alert("Sele√ß√£o incompleta")
salvando=false
return
}

// ===== CHECAR CONFLITO REALTIME =====

let snap = await DB.ag
.orderByChild("data")
.equalTo(dataSel)
.get()

let conflito=false

snap.forEach(c=>{
let a=c.val()
if(a.hora===horaSel && a.barbeiro===barbeiroSel){
conflito=true
}
})

if(conflito){
alert("Hor√°rio ocupado ‚Äî escolha outro")
renderHorariosCliente()
salvando=false
return
}

// ===== SALVAR =====

let ag={
servico:servicoSel.nome,
preco:servicoSel.preco,
barbeiro:barbeiroSel,
data:dataSel,
hora:horaSel,
cliente:clienteNome.value,
fone:clienteFone.value,
ts:Date.now()
}

await DB.ag.push(ag)

enviarWhatsConfirmacao(ag)

alert("Agendamento confirmado üíà")

location.reload()

}

// =========================
// SYNC SERVI√áOS
// =========================

DB.servicos.on("value",snap=>{

if(snap.exists()){
servicos = Object.values(snap.val())
}else{
DB.servicos.set([
{nome:"Corte",preco:40},
{nome:"Barba",preco:30},
{nome:"Combo",preco:65}
])
return
}

renderServicos()
renderAdminServicos()

})

// =========================
// SYNC BARBEIROS
// =========================

DB.barbeiros.on("value",snap=>{

if(snap.exists()){
barbeiros = Object.values(snap.val())
}else{
DB.barbeiros.set(["Carlos","Pedro"])
return
}

renderAdminBarbeiros()

})

// =========================
// SYNC CONFIG
// =========================

DB.config.on("value",snap=>{

if(snap.exists()){
config=snap.val()
cfgAbertura.value=config.abertura
cfgFechamento.value=config.fechamento
cfgIntervalo.value=config.intervalo
}else{
DB.config.set(config)
}

})

// =========================
// SYNC AGENDAMENTOS
// =========================

DB.ag.on("value",snap=>{
agendamentos = snap.exists()? Object.values(snap.val()):[]
renderAdminAgendamentos()
})

// =========================
// CRUD SERVI√áOS
// =========================

btnAddServico.onclick = ()=>{

if(!novoServicoNome.value || !novoServicoPreco.value) return

servicos.push({
nome:novoServicoNome.value,
preco:Number(novoServicoPreco.value)
})

DB.servicos.set(servicos)

novoServicoNome.value=""
novoServicoPreco.value=""

}

function removerServico(i){
servicos.splice(i,1)
DB.servicos.set(servicos)
}

// =========================
// CRUD BARBEIROS
// =========================

btnAddBarbeiro.onclick = ()=>{

if(!novoBarbeiro.value) return

barbeiros.push(novoBarbeiro.value)
DB.barbeiros.set(barbeiros)

novoBarbeiro.value=""

}

function removerBarbeiro(i){
barbeiros.splice(i,1)
DB.barbeiros.set(barbeiros)
}

// =========================
// SALVAR CONFIG BASE
// =========================

btnSalvarCfg.onclick = ()=>{

config={
abertura:cfgAbertura.value,
fechamento:cfgFechamento.value,
intervalo:Number(cfgIntervalo.value)
}

DB.config.set(config)

alert("Configura√ß√£o salva ‚úÖ")

}

// =========================
// EXPORTAR AGENDA DO DIA
// =========================

btnExportarDia.onclick = ()=>{

let hoje=hojeISO()

let lista=agendamentos.filter(a=>a.data===hoje)

let txt=`AGENDA ${NOME_BARBEARIA} ‚Äî ${hoje}\n\n`

lista.forEach(a=>{
txt+=`${a.hora} ‚Äî ${a.cliente} ‚Äî ${a.servico}\n`
})

navigator.clipboard.writeText(txt)
alert("Agenda copiada ‚úÖ")

}

// =========================
// SETUP R√ÅPIDO
// =========================

btnSetup.onclick = ()=>{

let nome=prompt("Nome da barbearia:")
if(nome){
NOME_BARBEARIA=nome.toUpperCase()
aplicarNome()
}

let zap=prompt("WhatsApp DDD+n√∫mero:")
if(zap){
WHATS_BARBEARIA="55"+zap.replace(/\D/g,"")
}

alert("Setup aplicado ‚úÖ")

}

// =========================
// DEMO
// =========================

btnDemo.onclick = ()=>{

DB.ag.push({
servico:"Corte",
preco:40,
barbeiro:"Carlos",
data:hojeISO(),
hora:"10:00",
cliente:"Cliente Demo",
fone:"11999999999",
ts:Date.now()
})

alert("Demo criado ‚úÖ")

}

</script>
<script>

// =========================
// SERVICE WORKER REGISTER (PWA)
// =========================

if ("serviceWorker" in navigator) {
navigator.serviceWorker
.register("sw.js")
.then(()=>{
console.log("Service Worker registrado ‚úÖ")
})
.catch(()=>{
console.log("Service Worker falhou ‚ùå")
})
}

// =========================
// LOG FINAL
// =========================

console.log("üíà BARBARUJO PREMIUM ‚Äî SISTEMA COMPLETO ATIVO")
console.log("Agenda online carregada")
console.log("Admin por toque prolongado ou duplo clique")
console.log("Disponibilidade por data ativa")
console.log("Fluxo reservar ‚Üí confirmar ativo")
console.log("Firebase realtime conectado")
console.log("PWA habilitado")

</script>

</div>
</body>
</html>
