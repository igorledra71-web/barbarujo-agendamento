<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Barbarujo Agenda Pro</title>

<style>

*{box-sizing:border-box}

body{
margin:0;
background:#0b0b0b;
color:#f2f2f2;
font-family:Segoe UI, Arial, sans-serif;
}

header{
background:#000;
padding:24px;
text-align:center;
border-bottom:3px solid #caa63a;
}

header h1{
margin:0;
letter-spacing:2px;
font-weight:600;
}

.card{
background:linear-gradient(180deg,#181818,#101010);
margin:16px;
padding:20px;
border-radius:16px;
border:1px solid #2a2a2a;
box-shadow:0 12px 30px rgba(0,0,0,.6);
}

h2{
margin-top:0;
color:#e7c15a;
font-size:18px;
}

label{
font-size:13px;
opacity:.9;
}

input,select{
width:100%;
padding:13px;
margin:6px 0 14px 0;
border-radius:10px;
border:1px solid #333;
background:#0f0f0f;
color:white;
}

button{
width:100%;
padding:14px;
border-radius:12px;
border:none;
background:linear-gradient(90deg,#caa63a,#e7c15a);
color:#111;
font-weight:700;
cursor:pointer;
letter-spacing:.5px;
}

button:hover{
opacity:.9;
transform:translateY(-1px);
}

.hidden{display:none}

.grid{
display:grid;
grid-template-columns:repeat(3,1fr);
gap:8px;
}

.hora{
padding:12px;
text-align:center;
border-radius:10px;
background:#1c1c1c;
border:1px solid #333;
cursor:pointer;
font-size:14px;
}

.hora.sel{
background:#e7c15a;
color:#000;
font-weight:700;
}

.hora.ocupado{
background:#5a1a1a;
opacity:.6;
cursor:not-allowed;
}

.hora.bloq{
background:#444;
opacity:.5;
cursor:not-allowed;
}

.item{
background:#141414;
padding:10px;
border-radius:10px;
margin:6px 0;
border:1px solid #2a2a2a;
font-size:14px;
}

.row{
display:flex;
gap:8px;
}

.row button{
width:auto;
padding:8px 10px;
font-size:12px;
border-radius:8px;
}

.adminBtn{
position:fixed;
bottom:12px;
right:12px;
opacity:.18;
font-size:24px;
cursor:pointer;
}

.timeChip{
display:inline-block;
padding:8px 10px;
margin:4px;
border-radius:8px;
background:#222;
border:1px solid #333;
font-size:13px;
}

.timeChip.bloq{
background:#5a1a1a;
border-color:#772222;
}

</style>
</head>

<body>

<header>
<h1>BARBARUJO AGENDA PRO</h1>
</header>
<!-- LOGIN CLIENTE -->

<div class="card" id="loginBox">
<h2>Entrar</h2>

<label>Nome</label>
<input id="cliNome">

<label>WhatsApp</label>
<input id="cliTel">

<button onclick="loginCliente()">Entrar</button>
</div>


<!-- ÁREA CLIENTE -->

<div id="areaCliente" class="hidden">

<div class="card">
<h2>Novo Agendamento</h2>

<label>Barbeiro</label>
<select id="barbeiro"></select>

<label>Serviço</label>
<select id="servico"></select>

<label>Data</label>
<input type="date" id="data">

<label>Horário</label>
<div id="horarios" class="grid"></div>

<button onclick="confirmarAgendamento()">Confirmar Agendamento</button>
</div>


<div class="card">
<h2>Meus Agendamentos</h2>
<div id="listaMeus"></div>
</div>

</div>


<!-- BOTÃO ADMIN -->

<div class="adminBtn" onclick="abrirAdmin()">⚙</div>


<!-- LOGIN ADMIN -->

<div class="card hidden" id="adminLogin">
<h2>Painel Admin</h2>
<input type="password" id="adminSenha" placeholder="Senha">
<button onclick="loginAdmin()">Entrar</button>
</div>


<!-- ÁREA ADMIN -->

<div id="adminArea" class="hidden">

<div class="card">
<h2>Configuração</h2>

<label>Limite de encaixe por horário</label>
<input id="cfgLimite" type="number">

<button onclick="salvarConfig()">Salvar Config</button>
</div>


<div class="card">
<h2>Barbeiros</h2>

<input id="novoBarbeiro" placeholder="Nome barbeiro">
<button onclick="addBarbeiro()">Adicionar</button>

<div id="listaBarbeiros"></div>
</div>


<div class="card">
<h2>Serviços</h2>

<input id="novoServico" placeholder="Nome serviço">
<button onclick="addServico()">Adicionar</button>

<div id="listaServicos"></div>
</div>


<div class="card">
<h2>Agenda Geral</h2>
<div id="agendaAdmin"></div>
</div>


<!-- CONTROLE AVANÇADO DE HORÁRIOS -->

<div class="card">
<h2>Controle de Horários</h2>

<label>Data</label>
<input type="date" id="admData">

<div id="admHorarios"></div>

<label>Bloquear horário manual</label>
<input type="time" id="admHoraBloq">
<button onclick="bloquearHorarioManual()">Bloquear</button>

<div>
<b>Bloqueados:</b>
<div id="admBloqueados"></div>
</div>

</div>

</div>
<script>

// =======================
// BANCO LOCAL
// =======================

function dbGet(k, def){
return JSON.parse(localStorage.getItem(k) || JSON.stringify(def));
}

function dbSet(k,v){
localStorage.setItem(k, JSON.stringify(v));
}


// =======================
// DADOS INICIAIS
// =======================

if(!localStorage.getItem("barbeiros")){
dbSet("barbeiros",["Carlos","João"]);
}

if(!localStorage.getItem("servicos")){
dbSet("servicos",["Corte","Corte + Barba"]);
}

if(!localStorage.getItem("agendamentos")){
dbSet("agendamentos",[]);
}

if(!localStorage.getItem("bloqueios")){
dbSet("bloqueios",[]);
}

if(!localStorage.getItem("config")){
dbSet("config",{limite:2});
}


// =======================
// ESTADO
// =======================

let horaSel = null;


// =======================
// LOGIN CLIENTE
// =======================

function loginCliente(){

const nome = cliNome.value.trim();
const tel = cliTel.value.trim();

if(!nome || !tel){
alert("Preencha nome e WhatsApp");
return;
}

localStorage.setItem("cliNome", nome);
localStorage.setItem("cliTel", tel);

loginBox.classList.add("hidden");
areaCliente.classList.remove("hidden");

carregarSelects();
gerarHorarios();
listarMeus();
}


// =======================
// SELECTS
// =======================

function carregarSelects(){

const bs = dbGet("barbeiros",[]);
barbeiro.innerHTML = "";
bs.forEach(b=>{
barbeiro.innerHTML += `<option>${b}</option>`;
});

const ss = dbGet("servicos",[]);
servico.innerHTML = "";
ss.forEach(s=>{
servico.innerHTML += `<option>${s}</option>`;
});
}

// =======================
// GERAR HORÁRIOS
// =======================

function gerarHorarios(){

horaSel = null;
horarios.innerHTML = "";

for(let h=8; h<=20; h++){

["00","30"].forEach(m=>{

const hh = h.toString().padStart(2,"0");
const hora = hh + ":" + m;

horarios.innerHTML +=
`<div class="hora" data-h="${hora}">${hora}</div>`;

});

}

document.querySelectorAll(".hora")
.forEach(el=>{
el.onclick = ()=>selecionarHora(el);
});

atualizarVisualHorarios();
}


// =======================
// SELECIONAR HORA
// =======================

function selecionarHora(el){

if(el.classList.contains("ocupado")) return;
if(el.classList.contains("bloq")) return;

document.querySelectorAll(".hora")
.forEach(x=>x.classList.remove("sel"));

el.classList.add("sel");
horaSel = el.dataset.h;
}


// =======================
// ATUALIZAR VISUAL HORÁRIOS
// =======================

function atualizarVisualHorarios(){

const dataSel = data.value;
if(!dataSel) return;

const lista = dbGet("agendamentos",[]);
const bloqueios = dbGet("bloqueios",[]);
const limite = dbGet("config",{}).limite || 2;

let mapa = {};

lista.forEach(a=>{
if(a.data === dataSel && a.status==="ativo"){
mapa[a.hora] = (mapa[a.hora]||0)+1;
}
});

document.querySelectorAll(".hora").forEach(el=>{

const h = el.dataset.h;

el.classList.remove("ocupado");
el.classList.remove("bloq");

if(mapa[h] >= limite){
el.classList.add("ocupado");
}

const bloq = bloqueios.some(b =>
b.data===dataSel && b.hora===h
);

if(bloq){
el.classList.add("bloq");
}

});
}


// atualizar quando muda data
data.onchange = atualizarVisualHorarios;
// =======================
// CONFIRMAR AGENDAMENTO
// =======================

function confirmarAgendamento(){

const dataSel = data.value;
const barb = barbeiro.value;
const serv = servico.value;
const nome = localStorage.getItem("cliNome");
const tel = localStorage.getItem("cliTel");

if(!dataSel || !horaSel){
alert("Escolha data e horário");
return;
}

const lista = dbGet("agendamentos",[]);
const bloqueios = dbGet("bloqueios",[]);
const limite = dbGet("config",{}).limite || 2;


// ===== BLOQUEIO ADMIN =====

const bloqueado = bloqueios.some(b =>
b.data===dataSel && b.hora===horaSel
);

if(bloqueado){
alert("Horário bloqueado pelo admin");
return;
}


// ===== LIMITE ENCAIXE =====

const qtdHora = lista.filter(a =>
a.data===dataSel &&
a.hora===horaSel &&
a.status==="ativo"
).length;

if(qtdHora >= limite){
alert("Horário lotado");
return;
}


// ===== BARBEIRO OCUPADO =====

const barbBusy = lista.some(a =>
a.data===dataSel &&
a.hora===horaSel &&
a.barbeiro===barb &&
a.status==="ativo"
);

if(barbBusy){
alert("Barbeiro já ocupado nesse horário");
return;
}


// ===== SALVAR =====

lista.push({
id: Date.now(),
nome:nome,
tel:tel,
barbeiro:barb,
servico:serv,
data:dataSel,
hora:horaSel,
status:"ativo",
criado:Date.now()
});

dbSet("agendamentos", lista);

alert("Agendamento confirmado");

listarMeus();
atualizarVisualHorarios();
listarAgendaAdmin();
}
// =======================
// LISTAR MEUS AGENDAMENTOS
// =======================

function listarMeus(){

const tel = localStorage.getItem("cliTel");
const lista = dbGet("agendamentos",[]);

listaMeus.innerHTML = "";

lista
.filter(a => a.tel===tel && a.status==="ativo")
.sort((a,b)=>(a.data+a.hora).localeCompare(b.data+b.hora))
.forEach(a => {

listaMeus.innerHTML += `
<div class="item">
${a.data} ${a.hora} — ${a.servico} — ${a.barbeiro}
<div class="row">
<button onclick="cancelarAg(${a.id})">Cancelar</button>
</div>
</div>
`;

});
}


// =======================
// CANCELAR AGENDAMENTO
// =======================

function cancelarAg(id){

let lista = dbGet("agendamentos",[]);

lista = lista.map(a=>{
if(a.id===id){
a.status = "cancelado";
}
return a;
});

dbSet("agendamentos", lista);

listarMeus();
atualizarVisualHorarios();
listarAgendaAdmin();
}
// =======================
// ABRIR ADMIN
// =======================

function abrirAdmin(){
adminLogin.classList.remove("hidden");
}


// =======================
// LOGIN ADMIN
// =======================

function loginAdmin(){

if(adminSenha.value !== "1234"){
alert("Senha incorreta");
return;
}

adminLogin.classList.add("hidden");
adminArea.classList.remove("hidden");

carregarAdmin();
}


// =======================
// CONFIG ADMIN
// =======================

function salvarConfig(){

const cfg = dbGet("config",{});
cfg.limite = parseInt(cfgLimite.value) || 2;

dbSet("config", cfg);

alert("Config salva");

atualizarVisualHorarios();
}


// =======================
// CARREGAR ADMIN
// =======================

function carregarAdmin(){

const cfg = dbGet("config",{});
cfgLimite.value = cfg.limite || 2;

listarBarbeirosAdmin();
listarServicosAdmin();
listarAgendaAdmin();
carregarPainelHorariosAdmin();
}


// =======================
// AGENDA GERAL ADMIN
// =======================

function listarAgendaAdmin(){

const lista = dbGet("agendamentos",[]);

agendaAdmin.innerHTML = "";

lista
.filter(a => a.status==="ativo")
.sort((a,b)=>(a.data+a.hora).localeCompare(b.data+b.hora))
.forEach(a => {

agendaAdmin.innerHTML += `
<div class="item">
${a.data} ${a.hora} — ${a.nome} — ${a.servico} — ${a.barbeiro}
</div>
`;

});
}
// =======================
// BARBEIROS ADMIN
// =======================

function addBarbeiro(){

const nome = novoBarbeiro.value.trim();
if(!nome) return;

const lista = dbGet("barbeiros",[]);
lista.push(nome);
dbSet("barbeiros", lista);

novoBarbeiro.value = "";

listarBarbeirosAdmin();
carregarSelects();
}


function listarBarbeirosAdmin(){

const lista = dbGet("barbeiros",[]);
listaBarbeiros.innerHTML = "";

lista.forEach((b,i)=>{
listaBarbeiros.innerHTML += `
<div class="item">
${b}
<div class="row">
<button onclick="delBarbeiro(${i})">Excluir</button>
</div>
</div>
`;
});
}


function delBarbeiro(i){

const lista = dbGet("barbeiros",[]);
lista.splice(i,1);
dbSet("barbeiros", lista);

listarBarbeirosAdmin();
carregarSelects();
}



// =======================
// SERVIÇOS ADMIN
// =======================

function addServico(){

const nome = novoServico.value.trim();
if(!nome) return;

const lista = dbGet("servicos",[]);
lista.push(nome);
dbSet("servicos", lista);

novoServico.value = "";

listarServicosAdmin();
carregarSelects();
}


function listarServicosAdmin(){

const lista = dbGet("servicos",[]);
listaServicos.innerHTML = "";

lista.forEach((s,i)=>{
listaServicos.innerHTML += `
<div class="item">
${s}
<div class="row">
<button onclick="delServico(${i})">Excluir</button>
</div>
</div>
`;
});
}


function delServico(i){

const lista = dbGet("servicos",[]);
lista.splice(i,1);
dbSet("servicos", lista);

listarServicosAdmin();
carregarSelects();
}
// =======================
// PAINEL HORÁRIOS ADMIN
// =======================

admData.onchange = carregarPainelHorariosAdmin;

function carregarPainelHorariosAdmin(){

if(!admData.value) return;

const dataSel = admData.value;
const lista = dbGet("agendamentos",[]);
const bloqueios = dbGet("bloqueios",[]);

admHorarios.innerHTML = "";
admBloqueados.innerHTML = "";

// horários com agendamento

lista
.filter(a => a.data===dataSel && a.status==="ativo")
.forEach(a => {

admHorarios.innerHTML +=
`<span class="timeChip">
${a.hora} — ${a.nome}
</span>`;

});

// bloqueados

bloqueios
.filter(b => b.data===dataSel)
.forEach(b => {

admBloqueados.innerHTML +=
`<span class="timeChip bloq">
${b.hora}
<button onclick="removerBloqueio('${b.data}','${b.hora}')">x</button>
</span>`;

});
}



// =======================
// BLOQUEAR HORÁRIO MANUAL
// =======================

function bloquearHorarioManual(){

const dataSel = admData.value;
const hora = admHoraBloq.value;

if(!dataSel || !hora){
alert("Escolha data e hora");
return;
}

const lista = dbGet("bloqueios",[]);

lista.push({
data:dataSel,
hora:hora
});

dbSet("bloqueios", lista);

carregarPainelHorariosAdmin();
atualizarVisualHorarios();
}



// =======================
// REMOVER BLOQUEIO
// =======================

function removerBloqueio(dataSel,hora){

let lista = dbGet("bloqueios",[]);

lista = lista.filter(b =>
!(b.data===dataSel && b.hora===hora)
);

dbSet("bloqueios", lista);

carregarPainelHorariosAdmin();
atualizarVisualHorarios();
}



// =======================
// AUTO CANCELAMENTO (30min)
// =======================

setInterval(()=>{

let lista = dbGet("agendamentos",[]);
let mudou = false;

lista.forEach(a => {

if(a.status==="ativo"){
if(Date.now() - a.criado > 30*60*1000){
a.status = "cancelado_auto";
mudou = true;
}
}

});

if(mudou){
dbSet("agendamentos", lista);
listarMeus();
listarAgendaAdmin();
atualizarVisualHorarios();
}

},60000);



// =======================
// INIT FINAL
// =======================

(function init(){

carregarSelects();

})();

</script>

</body>
</html>
