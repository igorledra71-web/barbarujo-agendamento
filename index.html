<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Agenda Barbearia Pro</title>

<style>

*{box-sizing:border-box}

body{
margin:0;
font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial;
background:#0b0b0b;
color:#eee;
}

header{
padding:18px;
text-align:center;
background:#000;
border-bottom:1px solid #222;
letter-spacing:2px;
font-weight:bold;
}

.card{
margin:14px;
padding:16px;
border-radius:16px;
background:#151515;
border:1px solid #262626;
box-shadow:0 10px 30px rgba(0,0,0,.6);
}

h2{
margin:0 0 12px 0;
font-size:16px;
color:#f1d27a;
}

input,select{
width:100%;
padding:12px;
margin:6px 0 12px 0;
border-radius:12px;
border:1px solid #333;
background:#101010;
color:white;
font-size:14px;
}

button{
width:100%;
padding:13px;
border-radius:14px;
border:none;
font-weight:700;
background:linear-gradient(135deg,#d4af37,#f5d77a);
color:#111;
cursor:pointer;
}

.item{
background:#101010;
border:1px solid #262626;
padding:10px;
border-radius:12px;
margin:8px 0;
font-size:14px;
}

.hidden{display:none}

.adminBtn{
position:fixed;
bottom:14px;
right:14px;
font-size:24px;
opacity:.25;
cursor:pointer;
}

.modal{
position:fixed;
inset:0;
background:rgba(0,0,0,.75);
display:flex;
align-items:center;
justify-content:center;
}

.modalBox{
width:92%;
max-width:420px;
background:#111;
border-radius:18px;
padding:16px;
border:1px solid #333;
}

.grid{
display:grid;
grid-template-columns:repeat(4,1fr);
gap:8px;
}

.slot{
padding:10px;
border-radius:10px;
background:#1a1a1a;
border:1px solid #333;
text-align:center;
cursor:pointer;
}

.slot.sel{
background:#f5d77a;
color:#000;
font-weight:700;
}

.slot.off{
opacity:.35;
text-decoration:line-through;
cursor:not-allowed;
}

</style>
</head>
<body>

<header>AGENDA BARBEARIA PRO</header>
<!-- LOGIN CLIENTE -->

<div class="card" id="loginBox">
<h2>Entrar</h2>

<input id="cliNome" placeholder="Nome">
<input id="cliTel" placeholder="WhatsApp">

<button onclick="loginCliente()">Entrar</button>
</div>



<!-- AREA CLIENTE -->

<div id="areaCliente" class="hidden">

<div class="card">
<h2>Novo Agendamento</h2>

<label>Barbeiro</label>
<select id="barbeiro"></select>

<label>Serviço</label>
<select id="servico"></select>

<label>Data</label>
<input type="date" id="dataInp">

<label>Horário</label>
<input id="horaView" readonly placeholder="Escolher horário">
<button onclick="abrirHoras()">Selecionar Horário</button>

<button onclick="confirmarAg()">Confirmar Agendamento</button>
</div>


<div class="card">
<h2>Meus Agendamentos</h2>
<div id="listaMeus"></div>
</div>

</div>



<!-- BOTÃO ADMIN -->

<div class="adminBtn" onclick="abrirAdmin()">⚙</div>



<!-- LOGIN ADMIN -->

<div class="card hidden" id="adminLogin">
<h2>Painel Admin</h2>

<input type="password" id="admSenha" placeholder="Senha">
<button onclick="loginAdmin()">Entrar</button>
</div>



<!-- AREA ADMIN -->

<div id="areaAdmin" class="hidden">

<div class="card">
<h2>Barbeiros</h2>
<input id="novoBarb">
<button onclick="addBarb()">Adicionar</button>
<div id="listaBarb"></div>
</div>


<div class="card">
<h2>Serviços</h2>
<input id="novoServ">
<button onclick="addServ()">Adicionar</button>
<div id="listaServ"></div>
</div>


<div class="card">
<h2>Horários Disponíveis do Dia</h2>
<input type="date" id="admData">
<input type="time" id="admHora">
<button onclick="addDisp()">Liberar Horário</button>
<div id="listaDisp"></div>
</div>

</div>



<!-- MODAL HORÁRIOS -->

<div class="modal hidden" id="modalHoras">
<div class="modalBox">

<h2>Escolher Horário</h2>
<div class="grid" id="gridHoras"></div>

<button onclick="fecharHoras()">Fechar</button>

</div>
</div>
<script>

// ======================
// BANCO LOCAL
// ======================

function dbGet(k,def){
return JSON.parse(localStorage.getItem(k) || JSON.stringify(def));
}

function dbSet(k,v){
localStorage.setItem(k,JSON.stringify(v));
}


// ======================
// DADOS INICIAIS
// ======================

if(!localStorage.getItem("barbeiros")){
dbSet("barbeiros",["Carlos","João"]);
}

if(!localStorage.getItem("servicos")){
dbSet("servicos",["Corte","Barba"]);
}

if(!localStorage.getItem("disponibilidade")){
dbSet("disponibilidade",[]);
}

if(!localStorage.getItem("agendamentos")){
dbSet("agendamentos",[]);
}


// ======================
// ESTADO
// ======================

let horaSel = null;


// ======================
// LOGIN CLIENTE
// ======================

function loginCliente(){

const n = cliNome.value.trim();
const t = cliTel.value.trim();

if(!n || !t){
alert("Preencha os dados");
return;
}

localStorage.setItem("cliNome",n);
localStorage.setItem("cliTel",t);

loginBox.classList.add("hidden");
areaCliente.classList.remove("hidden");

carregarSelects();
listarMeus();
}


// ======================
// LOGIN ADMIN
// ======================

function abrirAdmin(){
adminLogin.classList.remove("hidden");
}

function loginAdmin(){

if(admSenha.value !== "1234"){
alert("Senha incorreta");
return;
}

adminLogin.classList.add("hidden");
areaAdmin.classList.remove("hidden");

renderAdmin();
}


// ======================
// SELECTS
// ======================

function carregarSelects(){

const bs = dbGet("barbeiros",[]);
barbeiro.innerHTML="";
bs.forEach(b=>{
barbeiro.innerHTML += `<option>${b}</option>`;
});

const ss = dbGet("servicos",[]);
servico.innerHTML="";
ss.forEach(s=>{
servico.innerHTML += `<option>${s}</option>`;
});
}


// ======================
// INIT
// ======================

(function(){
carregarSelects();
})();

// ======================
// MODAL HORÁRIOS
// ======================

function abrirHoras(){

const data = dataInp.value;

if(!data){
alert("Escolha a data primeiro");
return;
}

const disp = dbGet("disponibilidade",[]);
const dia = disp.find(x=>x.data===data);

if(!dia || dia.horas.length===0){
alert("Nenhum horário liberado para este dia");
return;
}

modalHoras.classList.remove("hidden");
renderHoras();
}


function fecharHoras(){
modalHoras.classList.add("hidden");
}



// ======================
// RENDER HORÁRIOS
// ======================

function renderHoras(){

gridHoras.innerHTML="";
horaSel = null;
horaView.value="";

const data = dataInp.value;
const disp = dbGet("disponibilidade",[]);
const dia = disp.find(x=>x.data===data);

if(!dia || dia.horas.length===0){
gridHoras.innerHTML =
"<div style='grid-column:1/-1;opacity:.7'>Sem horários</div>";
return;
}

dia.horas.sort().forEach(h=>{

gridHoras.innerHTML += `
<div class="slot" onclick="selHora('${h}',this)">
${h}
</div>`;

});
}


// ======================
// SELECIONAR HORA
// ======================

function selHora(h,el){

horaSel = h;
horaView.value = h;

document.querySelectorAll(".slot")
.forEach(x=>x.classList.remove("sel"));

el.classList.add("sel");
}



// ======================
// ADMIN DISPONIBILIDADE
// ======================

function addDisp(){

const d = admData.value;
const h = admHora.value;

if(!d || !h){
alert("Escolha data e hora");
return;
}

let disp = dbGet("disponibilidade",[]);
let dia = disp.find(x=>x.data===d);

if(!dia){
dia = {data:d,horas:[]};
disp.push(dia);
}

if(!dia.horas.includes(h)){
dia.horas.push(h);
}

dbSet("disponibilidade",disp);
listarDispAdmin();
}


function listarDispAdmin(){

if(!admData.value){
listaDisp.innerHTML="";
return;
}

const d = admData.value;
const disp = dbGet("disponibilidade",[]);
const dia = disp.find(x=>x.data===d);

listaDisp.innerHTML="";

(dia?.horas || []).sort().forEach(h=>{
listaDisp.innerHTML += `
<div class="item">${h}</div>`;
});
}

admData.onchange = listarDispAdmin;
// ======================
// CONFIRMAR AGENDAMENTO
// ======================

function confirmarAg(){

const data = dataInp.value;

if(!data || !horaSel){
alert("Escolha data e horário");
return;
}

const barb = barbeiro.value;
const serv = servico.value;
const nome = localStorage.getItem("cliNome");
const tel  = localStorage.getItem("cliTel");

let lista = dbGet("agendamentos",[]);


// ===== DISPONIBILIDADE =====

const disp = dbGet("disponibilidade",[]);
const dia = disp.find(x=>x.data===data);

if(!dia || !dia.horas.includes(horaSel)){
alert("Horário não disponível");
return;
}


// ===== CONFLITO BARBEIRO =====

const conflito = lista.some(a =>
a.data===data &&
a.hora===horaSel &&
a.barbeiro===barb &&
a.status==="ativo"
);

if(conflito){
alert("Barbeiro ocupado nesse horário");
return;
}


// ===== SALVAR =====

lista.push({
id: Date.now(),
nome:nome,
tel:tel,
barbeiro:barb,
servico:serv,
data:data,
hora:horaSel,
status:"ativo"
});

dbSet("agendamentos",lista);

alert("Agendamento confirmado");

listarMeus();
fecharHoras();
}
// ======================
// LISTA CLIENTE
// ======================

function listarMeus(){

const tel = localStorage.getItem("cliTel");
const lista = dbGet("agendamentos",[]);

listaMeus.innerHTML = "";

lista
.filter(a => a.tel===tel && a.status==="ativo")
.sort((a,b)=>(a.data+a.hora).localeCompare(b.data+b.hora))
.forEach(a=>{

listaMeus.innerHTML += `
<div class="item">
${a.data} ${a.hora}<br>
${a.servico} — ${a.barbeiro}
<button onclick="cancelarAg(${a.id})">Cancelar</button>
</div>
`;

});
}



// ======================
// CANCELAR AGENDAMENTO
// ======================

function cancelarAg(id){

let lista = dbGet("agendamentos",[]);

lista = lista.map(a=>{
if(a.id===id){
a.status = "cancelado";
}
return a;
});

dbSet("agendamentos",lista);
listarMeus();
}
// ======================
// ADMIN — BARBEIROS
// ======================

function addBarb(){

const n = novoBarb.value.trim();
if(!n) return;

let l = dbGet("barbeiros",[]);
l.push(n);
dbSet("barbeiros",l);

novoBarb.value="";
renderAdmin();
carregarSelects();
}

function delBarb(i){

let l = dbGet("barbeiros",[]);
l.splice(i,1);
dbSet("barbeiros",l);

renderAdmin();
carregarSelects();
}



// ======================
// ADMIN — SERVIÇOS
// ======================

function addServ(){

const n = novoServ.value.trim();
if(!n) return;

let l = dbGet("servicos",[]);
l.push(n);
dbSet("servicos",l);

novoServ.value="";
renderAdmin();
carregarSelects();
}

function delServ(i){

let l = dbGet("servicos",[]);
l.splice(i,1);
dbSet("servicos",l);

renderAdmin();
carregarSelects();
}



// ======================
// RENDER ADMIN
// ======================

function renderAdmin(){

// barbeiros
const bs = dbGet("barbeiros",[]);
listaBarb.innerHTML="";

bs.forEach((b,i)=>{
listaBarb.innerHTML += `
<div class="item">
${b}
<button onclick="delBarb(${i})">Excluir</button>
</div>`;
});


// serviços
const ss = dbGet("servicos",[]);
listaServ.innerHTML="";

ss.forEach((s,i)=>{
listaServ.innerHTML += `
<div class="item">
${s}
<button onclick="delServ(${i})">Excluir</button>
</div>`;
});

listarDispAdmin();
}

</script>

</body>
</html>
