<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>BARBARUJO ‚Ä¢ Agendamento</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0e0e0e">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Poppins,sans-serif}
body{background:#0e0e0e;color:#fff}
header{background:#111;padding:20px;text-align:center;font-size:26px;font-weight:700;border-bottom:2px solid #222;cursor:pointer}

.container{max-width:960px;margin:auto;padding:20px}

.card{
background:#181818;
border-radius:16px;
padding:20px;
margin-bottom:18px;
box-shadow:0 0 18px rgba(0,0,0,.35)
}

h3{margin-bottom:12px}

.grid{
display:grid;
grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
gap:12px
}

.btn{
background:#d4af37;
border:none;
padding:14px;
border-radius:12px;
font-weight:700;
width:100%;
cursor:pointer;
transition:.2s
}

.btn:hover{transform:scale(1.03)}

.btn-outline{
background:transparent;
border:2px solid #d4af37;
color:#d4af37;
padding:12px;
border-radius:12px;
width:100%;
cursor:pointer
}

input,select{
width:100%;
padding:12px;
border-radius:10px;
border:none;
margin-top:6px
}

.slot{
background:#222;
padding:12px;
border-radius:10px;
text-align:center;
cursor:pointer;
font-weight:700;
transition:.15s
}

.slot:hover{background:#2a2a2a}

.slot.booked{
background:#402020;
opacity:.5;
pointer-events:none
}

.slot.selected{
outline:3px solid #d4af37
}

.badge{
background:#d4af37;
color:#000;
padding:4px 8px;
border-radius:8px;
font-size:12px;
font-weight:700
}

.hidden{display:none}
</style>
</head>

<body>

<!-- SPLASH -->

<div id="telaSplash" style="
position:fixed;
inset:0;
background:#0e0e0e;
display:flex;
flex-direction:column;
align-items:center;
justify-content:center;
z-index:9999">

<h1 style="font-size:46px;margin-bottom:20px">üíà BARBARUJO</h1>
<p style="opacity:.7;margin-bottom:28px">Agendamento Online</p>

<button id="btnEntrar" class="btn" style="max-width:260px">
Agende seu hor√°rio
</button>

</div>

<header id="topo">üíà BARBARUJO</header>
<div class="container">
<!-- ================= CLIENTE ================= -->

<div id="telaCliente">

<div class="card">
<h3>Escolha o servi√ßo</h3>
<div id="listaServicos" class="grid"></div>
</div>

<div id="cardBarbeiro" class="card hidden">
<h3>Escolha o barbeiro</h3>
<div id="listaBarbeiros" class="grid"></div>
</div>

<div id="cardData" class="card hidden">
<h3>Escolha o dia dispon√≠vel</h3>
<select id="dataEscolhida"></select>
</div>

<div id="cardHorarios" class="card hidden">
<h3>Escolha o hor√°rio dispon√≠vel</h3>
<div id="listaHorarios" class="grid"></div>
</div>

<div id="cardCliente" class="card hidden">

<h3>Resumo da reserva</h3>
<div id="resumoEscolha"></div>

<input id="clienteNome" placeholder="Nome">
<input id="clienteFone" placeholder="WhatsApp">

<button id="btnReservar" class="btn">
Reservar hor√°rio
</button>

<button id="btnConfirmar" class="btn-outline hidden">
Confirmar agendamento
</button>

</div>

</div>

<!-- ================= ADMIN ================= -->

<div id="telaAdmin" class="hidden">

<div class="card">
<h3>Painel Administrador</h3>
<button id="btnLogout" class="btn-outline">Sair</button>
</div>

<div class="card">
<h3>Servi√ßos</h3>
<input id="novoServicoNome" placeholder="Nome">
<input id="novoServicoPreco" placeholder="Pre√ßo">
<button id="btnAddServico" class="btn">Adicionar</button>
<div id="adminServicos"></div>
</div>

<div class="card">
<h3>Barbeiros</h3>
<input id="novoBarbeiro" placeholder="Nome">
<button id="btnAddBarbeiro" class="btn">Adicionar</button>
<div id="adminBarbeiros"></div>
</div>

<div class="card">
<h3>Funcionamento base</h3>
<input type="time" id="cfgAbertura">
<input type="time" id="cfgFechamento">
<select id="cfgIntervalo">
<option>15</option>
<option>30</option>
<option>45</option>
<option>60</option>
</select>
<button id="btnSalvarCfg" class="btn">Salvar base</button>
</div>

<div class="card">
<h3>Disponibilidade por data</h3>

<input type="date" id="adminDataPick">

<button id="btnGerarSlots" class="btn">
Gerar hor√°rios do dia
</button>

<div id="adminSlotsGrid" class="grid"></div>

<button id="btnSalvarSlotsDia" class="btn">
Salvar disponibilidade do dia
</button>

</div>

<div class="card">
<h3>Ferramentas</h3>
<button id="btnExportarDia" class="btn">Copiar agenda</button>
<button id="btnSetup" class="btn">Setup r√°pido</button>
<button id="btnDemo" class="btn">Modo demo</button>
<button id="btnInstalarApp" class="btn">Instalar como app</button>
</div>

<div class="card">
<h3>Agendamentos</h3>
<div id="listaAgendamentos"></div>
</div>

</div>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>

<script>

const firebaseConfig = {
apiKey: "AIzaSyBDffb23AqSOoT-8Z94Ao9leB5nTSdIv78",
authDomain: "agenda-barbarujo.firebaseapp.com",
databaseURL: "https://agenda-barbarujo-default-rtdb.firebaseio.com/",
projectId: "agenda-barbarujo",
storageBucket: "agenda-barbarujo.firebasestorage.app",
messagingSenderId: "735138068544",
appId: "1:735138068544:web:5a1273bd8be9ef7ab487a5"
}

firebase.initializeApp(firebaseConfig)
const db = firebase.database()

const DB = {
servicos: db.ref("barbarujo/servicos"),
barbeiros: db.ref("barbarujo/barbeiros"),
config: db.ref("barbarujo/config"),
ag: db.ref("barbarujo/agendamentos"),
dispDia: db.ref("barbarujo/disponibilidade_por_dia")
}

</script>
<script>

// =========================
// ESTADO GLOBAL
// =========================

let servicos=[]
let barbeiros=[]
let agendamentos=[]
let disponibilidade={} // {data:[horas]}

let config={
abertura:"08:00",
fechamento:"18:00",
intervalo:30
}

let servicoSel=null
let barbeiroSel=null
let dataSel=null
let horaSel=null

let salvando=false

let escolhaStatus={
servico:false,
barbeiro:false,
data:false,
hora:false
}

// =========================
// WHITE LABEL
// =========================

let NOME_BARBEARIA="BARBARUJO"
let WHATS_BARBEARIA="5599999999999"

const ADMIN_SENHA="barbarujo123"

// =========================
// HELPERS
// =========================

function hojeISO(){
return new Date().toISOString().split("T")[0]
}

// m√°scara telefone
clienteFone.addEventListener("input",()=>{
clienteFone.value=
clienteFone.value.replace(/\D/g,"").slice(0,11)
})

adminDataPick.min=hojeISO()

// =========================
// SPLASH
// =========================

document.querySelector(".container").style.display="none"

btnEntrar.onclick=()=>{
telaSplash.style.display="none"
document.querySelector(".container").style.display="block"
}

// =========================
// NOME DIN√ÇMICO
// =========================

function aplicarNome(){
topo.innerText="üíà "+NOME_BARBEARIA
document.title=NOME_BARBEARIA+" ‚Ä¢ Agendamento"
}
aplicarNome()

// =========================
// PWA INSTALL CONTROL
// =========================

let deferredPrompt=null

window.addEventListener("beforeinstallprompt",e=>{
e.preventDefault()
deferredPrompt=e
})

btnInstalarApp.onclick=()=>{
if(deferredPrompt){
deferredPrompt.prompt()
}
}

</script>
<script>

// =========================
// RENDER SERVI√áOS
// =========================

function renderServicos(){
listaServicos.innerHTML=""

servicos.forEach(s=>{
let b=document.createElement("button")
b.className="btn"
b.innerHTML=`${s.nome}<br><span class=badge>R$ ${s.preco}</span>`

b.onclick=()=>{
servicoSel=s
escolhaStatus.servico=true
cardBarbeiro.classList.remove("hidden")
renderBarbeiros()
atualizarResumo()
}

listaServicos.appendChild(b)
})
}

// =========================
// RENDER BARBEIROS
// =========================

function renderBarbeiros(){
listaBarbeiros.innerHTML=""

barbeiros.forEach(n=>{
let b=document.createElement("button")
b.className="btn-outline"
b.innerText=n

b.onclick=()=>{
barbeiroSel=n
escolhaStatus.barbeiro=true
cardData.classList.remove("hidden")
renderDatasCliente()
atualizarResumo()
}

listaBarbeiros.appendChild(b)
})
}

// =========================
// RENDER DATAS CLIENTE
// =========================

function renderDatasCliente(){

dataEscolhida.innerHTML=""

Object.keys(disponibilidade)
.sort()
.forEach(d=>{
let opt=document.createElement("option")
opt.value=d
opt.textContent=d
dataEscolhida.appendChild(opt)
})

}

// =========================
// RESUMO ESCOLHA
// =========================

function atualizarResumo(){

resumoEscolha.innerHTML=`
<span class=badge>Servi√ßo</span> ${servicoSel?.nome||"-"}<br>
<span class=badge>Barbeiro</span> ${barbeiroSel||"-"}<br>
<span class=badge>Data</span> ${dataSel||"-"}<br>
<span class=badge>Hora</span> ${horaSel||"-"}
`

}

</script>
<script>

// =========================
// GERAR HOR√ÅRIOS BASE ADMIN
// =========================

btnGerarSlots.onclick=()=>{

let data=adminDataPick.value
if(!data){
alert("Escolha a data")
return
}

let ja=disponibilidade[data]||[]

let [ha,ma]=config.abertura.split(":").map(Number)
let [hf,mf]=config.fechamento.split(":").map(Number)

let ini=ha*60+ma
let fim=hf*60+mf

adminSlotsGrid.innerHTML=""

for(let t=ini;t<fim;t+=Number(config.intervalo)){

let h=Math.floor(t/60).toString().padStart(2,"0")
let m=(t%60).toString().padStart(2,"0")
let hora=h+":"+m

let div=document.createElement("div")
div.className="slot"
div.innerText=hora

if(ja.includes(hora)){
div.classList.add("selected")
}

div.onclick=()=>{
div.classList.toggle("selected")
}

adminSlotsGrid.appendChild(div)

}

}

// =========================
// SALVAR DISPONIBILIDADE DIA
// =========================

btnSalvarSlotsDia.onclick=()=>{

let data=adminDataPick.value
if(!data){
alert("Escolha a data")
return
}

let sel=[]
document
.querySelectorAll("#adminSlotsGrid .slot.selected")
.forEach(s=>sel.push(s.innerText))

if(sel.length===0){
alert("Selecione pelo menos um hor√°rio")
return
}

DB.dispDia.child(data).set(sel)

alert("Disponibilidade salva ‚úÖ")

}

// =========================
// SYNC DISPONIBILIDADE
// =========================

DB.dispDia.on("value",snap=>{
disponibilidade=snap.exists()?snap.val():{}
renderDatasCliente()
})

</script>
<script>

// =========================
// DATA CLIENTE
// =========================

dataEscolhida.onchange=()=>{

dataSel=dataEscolhida.value
escolhaStatus.data=true

renderHorariosCliente()
cardHorarios.classList.remove("hidden")
atualizarResumo()

}

// =========================
// HOR√ÅRIOS CLIENTE
// =========================

function renderHorariosCliente(){

listaHorarios.innerHTML=""
horaSel=null
escolhaStatus.hora=false

let lista=disponibilidade[dataSel]||[]

lista.forEach(hora=>{

let div=document.createElement("div")
div.className="slot"
div.innerText=hora

let ocupado=agendamentos.find(a=>
a.data===dataSel &&
a.hora===hora &&
a.barbeiro===barbeiroSel
)

if(ocupado){
div.classList.add("booked")
}

div.onclick=()=>{

if(div.classList.contains("booked")) return

document
.querySelectorAll("#listaHorarios .slot")
.forEach(s=>s.classList.remove("selected"))

div.classList.add("selected")

horaSel=hora
escolhaStatus.hora=true

cardCliente.classList.remove("hidden")
atualizarResumo()

}

listaHorarios.appendChild(div)

})

}

// =========================
// RESERVAR
// =========================

btnReservar.onclick=()=>{

if(!escolhaStatus.servico||
   !escolhaStatus.barbeiro||
   !escolhaStatus.data||
   !escolhaStatus.hora){
alert("Complete as escolhas")
return
}

if(!clienteNome.value||!clienteFone.value){
alert("Preencha seus dados")
return
}

alert("Hor√°rio reservado ‚Äî confirme abaixo")

btnReservar.classList.add("hidden")
btnConfirmar.classList.remove("hidden")

}

</script>
<script>

// =========================
// CONFIRMAR AGENDAMENTO
// =========================

function enviarWhats(ag){

let msg=`üíà ${NOME_BARBEARIA}
Agendamento confirmado
${ag.data} ${ag.hora}
${ag.servico}`

window.open(
"https://wa.me/55"+ag.fone+"?text="+encodeURIComponent(msg),
"_blank"
)

}

btnConfirmar.onclick=async()=>{

if(salvando) return
salvando=true

let snap=await DB.ag
.orderByChild("data")
.equalTo(dataSel)
.get()

let conflito=false

snap.forEach(c=>{
let a=c.val()
if(a.hora===horaSel && a.barbeiro===barbeiroSel){
conflito=true
}
})

if(conflito){
alert("Hor√°rio ocupado ‚Äî escolha outro")
renderHorariosCliente()
salvando=false
return
}

let ag={
servico:servicoSel.nome,
preco:servicoSel.preco,
barbeiro:barbeiroSel,
data:dataSel,
hora:horaSel,
cliente:clienteNome.value,
fone:clienteFone.value,
ts:Date.now()
}

await DB.ag.push(ag)

enviarWhats(ag)

alert("Agendamento confirmado üíà")

location.reload()

}

// =========================
// LOGIN ADMIN
// =========================

topo.ondblclick=()=>{
let s=prompt("Senha admin")
if(s===ADMIN_SENHA){
telaCliente.classList.add("hidden")
telaAdmin.classList.remove("hidden")
}
}

btnLogout.onclick=()=>{
telaAdmin.classList.add("hidden")
telaCliente.classList.remove("hidden")
}

// =========================
// SYNC DB
// =========================

DB.servicos.on("value",s=>{
servicos=s.exists()?Object.values(s.val()):[]
if(servicos.length===0){
DB.servicos.set([{nome:"Corte",preco:40}])
}
renderServicos()
renderAdminServicos()
})

DB.barbeiros.on("value",s=>{
barbeiros=s.exists()?Object.values(s.val()):[]
renderBarbeiros()
renderAdminBarbeiros()
})

DB.config.on("value",s=>{
if(s.exists()){
config=s.val()
cfgAbertura.value=config.abertura
cfgFechamento.value=config.fechamento
cfgIntervalo.value=config.intervalo
}
})

DB.ag.on("value",s=>{
agendamentos=s.exists()?Object.values(s.val()):[]
renderAdminAgendamentos()
})

// =========================
// CRUD SERVI√áOS
// =========================

btnAddServico.onclick=()=>{
servicos.push({
nome:novoServicoNome.value,
preco:Number(novoServicoPreco.value)
})
DB.servicos.set(servicos)
}

function removerServico(i){
servicos.splice(i,1)
DB.servicos.set(servicos)
}

// =========================
// CRUD BARBEIROS
// =========================

btnAddBarbeiro.onclick=()=>{
barbeiros.push(novoBarbeiro.value)
DB.barbeiros.set(barbeiros)
}

function removerBarbeiro(i){
barbeiros.splice(i,1)
DB.barbeiros.set(barbeiros)
}

// =========================
// EXPORTAR
// =========================

btnExportarDia.onclick=()=>{
let hoje=hojeISO()
let lista=agendamentos.filter(a=>a.data===hoje)
let txt="AGENDA\n"
lista.forEach(a=>{
txt+=a.hora+" "+a.cliente+"\n"
})
navigator.clipboard.writeText(txt)
alert("Copiado")
}

// =========================
// SETUP + DEMO
// =========================

btnSetup.onclick=()=>{
let n=prompt("Nome barbearia")
if(n){NOME_BARBEARIA=n;aplicarNome()}
}

btnDemo.onclick=()=>{
DB.ag.push({
servico:"Corte",
preco:40,
barbeiro:"Carlos",
data:hojeISO(),
hora:"10:00",
cliente:"Demo",
fone:"11999999999",
ts:Date.now()
})
}

</script>
<script>

// =========================
// SERVICE WORKER
// =========================

if("serviceWorker" in navigator){
navigator.serviceWorker.register("sw.js")
}

console.log("üíà BARBARUJO PREMIUM COMPLETO")

</script>

</div>
</body>
</html>
