<!DOCTYPE html>
<html lang="pt-br">
<head>

<meta charset="UTF-8">

<meta name="viewport"
content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">

<title>BARBARUJO ‚Ä¢ Agendamento</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0e0e0e">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700;900&display=swap" rel="stylesheet">

<style>

*{
margin:0;
padding:0;
box-sizing:border-box;
font-family:Poppins,sans-serif;
-webkit-tap-highlight-color: transparent;
user-select:none;
-webkit-user-select:none;
}

input, textarea{
user-select:text;
-webkit-user-select:text;
}

body{
background:#0e0e0e;
color:#fff;
overscroll-behavior:none;
}

header{
background:#111;
padding:20px;
text-align:center;
font-size:22px;
font-weight:800;
border-bottom:1px solid #222;
position:sticky;
top:0;
z-index:50;
letter-spacing:.5px;
}

.btn-back{
position:fixed;
left:14px;
top:14px;
z-index:9999;
background:#1c1c1c;
border:1px solid #333;
color:#fff;
width:42px;
height:42px;
border-radius:14px;
font-size:18px;
font-weight:900;
display:flex;
align-items:center;
justify-content:center;
}

.admin-fab{
position:fixed;
top:14px;
right:14px;
width:46px;
height:46px;
border-radius:14px;
background:linear-gradient(135deg,#d4af37,#f1d77a);
color:#000;
display:flex;
align-items:center;
justify-content:center;
font-size:20px;
font-weight:900;
z-index:9999;
}

.container{
max-width:1000px;
margin:auto;
padding:28px 18px 120px 18px;
display:none;
}

.card{
background:#171717;
border-radius:22px;
padding:28px;
margin-bottom:28px;
box-shadow:0 10px 30px rgba(0,0,0,.45);
border:1px solid #232323;
}

.card-sub{
background:#141414;
border:1px solid #262626;
}

.grid{
display:grid;
grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
gap:16px;
}

.btn{
background:linear-gradient(135deg,#d4af37,#f1d77a);
border:none;
padding:16px;
border-radius:16px;
font-weight:800;
width:100%;
color:#000;
font-size:15px;
}

.btn-outline{
background:transparent;
border:2px solid #d4af37;
color:#d4af37;
padding:14px;
border-radius:16px;
width:100%;
font-weight:800;
}

.btn-dark{
background:#242424;
border:1px solid #333;
color:#fff;
}

.btn-danger{
background:#402020;
border:2px solid #803030;
color:#ffb3b3;
}

input,select{
width:100%;
padding:16px;
border-radius:14px;
border:none;
margin-top:8px;
margin-bottom:14px;
color:#000;
font-size:15px;
}

.price{
font-size:22px;
font-weight:900;
background:linear-gradient(135deg,#d4af37,#ffe38a);
color:#000;
padding:8px 14px;
border-radius:14px;
display:inline-block;
margin-top:10px;
box-shadow:0 8px 22px rgba(212,175,55,.35);
}

.slot{
background:#202020;
padding:14px;
border-radius:14px;
text-align:center;
font-weight:800;
border:1px solid #2b2b2b;
cursor:pointer;
}

.slot.selected{
border:2px solid #d4af37;
background:#2b2616;
}

.slot.booked{
background:#402020;
opacity:.45;
pointer-events:none;
}

/* ================= SPLASH ================= */

.splash{
position:fixed;
inset:0;
background:#0e0e0e;
display:flex;
flex-direction:column;
align-items:center;
justify-content:flex-start;
z-index:99999;
padding:24px;
padding-top:20px;
text-align:center;
}

.splash-logo{
display:block;
width:84vw;
max-width:540px;
height:auto;
margin:30px auto 8px auto;
background:transparent;
border:none;
box-shadow:none;
transform: translateX(-6vw);
object-fit:contain;
}

.hidden{display:none}

/* ================= PAGAMENTO ================= */

.pagamento-box{
background:#141414;
border:1px solid #262626;
border-radius:16px;
padding:16px;
margin-top:16px;
}

.pagamento-grid{
display:grid;
grid-template-columns:repeat(2,1fr);
gap:12px;
margin-top:10px;
}

.pagamento-btn{
background:#202020;
border:1px solid #333;
border-radius:14px;
padding:12px;
font-weight:800;
text-align:center;
cursor:pointer;
}

.pagamento-btn.sel{
border:2px solid #d4af37;
background:#2b2616;
}

.pix-box{
margin-top:12px;
padding:12px;
border-radius:12px;
background:#1a1a1a;
border:1px dashed #d4af37;
font-size:14px;
line-height:1.5;
}

.relatorio-btn{
background:linear-gradient(135deg,#2e7d32,#66bb6a);
color:#fff;
border:none;
padding:16px;
border-radius:16px;
font-weight:900;
width:100%;
margin-bottom:12px;
}

</style>
</head>
<body>

<button id="btnBack" class="btn-back hidden">‚Üê</button>
<div id="btnAdminFab" class="admin-fab">‚öôÔ∏è</div>

<!-- ================= SPLASH ================= -->

<div id="telaSplash" class="splash">

<img src="logo.png" class="splash-logo">

<h1 style="
font-size:34px;
font-weight:900;
letter-spacing:.6px;
margin-bottom:10px;
margin-top:-60px;
">
üíà BARBARUJO
</h1>

<div style="
opacity:.9;
margin-bottom:22px;
font-size:14px;
line-height:1.6;
">

<b>Hor√°rio de atendimento</b><br><br>

Seg‚ÄìSex<br>
09:00‚Äì12:00<br>
14:00‚Äì19:00<br><br>

S√°bado<br>
09:00‚Äì17:00<br><br>

Domingo ‚Äî Fechado

</div>

<button id="btnEntrar" class="btn" style="max-width:360px">
Agendar hor√°rio
</button>

<button id="btnModoBarbeiro" class="btn btn-dark"
style="max-width:360px;margin-top:12px">
Sou barbeiro
</button>

</div>

<header id="topo">üíà BARBARUJO</header>

<div class="container">

<!-- ================= CLIENTE ================= -->

<div id="telaCliente">

<div class="card" id="cardServico">
<div class="step">PASSO 1</div>
<h3>Escolha o servi√ßo</h3>
<div id="listaServicos" class="grid"></div>
</div>
<div id="cardBarbeiro" class="card hidden">
<div class="step">PASSO 2</div>
<h3>Escolha o barbeiro</h3>
<div id="listaBarbeiros" class="grid"></div>
</div>

<div id="cardData" class="card hidden">
<div class="step">PASSO 3</div>
<h3>Escolha o dia</h3>

<select id="dataEscolhida"></select>

<button id="btnConfirmarData" class="btn-dark btn">
Ver hor√°rios deste dia
</button>
</div>

<div id="cardHorarios" class="card hidden">
<div class="step">PASSO 4</div>
<h3>Escolha o hor√°rio</h3>
<div id="listaHorarios" class="grid"></div>
</div>

<div id="cardCliente" class="card hidden">

<div class="step">PASSO 5</div>
<h3>Confirmar reserva</h3>

<div id="resumoEscolha"></div>

<input id="clienteNome" placeholder="Nome">
<input id="clienteFone" placeholder="WhatsApp">

<!-- ================= PAGAMENTO ================= -->

<div id="boxPagamento" class="pagamento-box hidden">

<b>Forma de pagamento</b>

<div class="pagamento-grid">
<div class="pagamento-btn" data-pg="pix">PIX</div>
<div class="pagamento-btn" data-pg="debito">D√©bito</div>
<div class="pagamento-btn" data-pg="credito">Cr√©dito</div>
<div class="pagamento-btn" data-pg="dinheiro">Dinheiro</div>
</div>

<div id="pixInfo" class="pix-box hidden">
<b>Pagamento via PIX</b><br>
Chave: <span id="pixChaveView">49999538762</span><br>
Valor: R$ <span id="pixValorView">0,00</span><br><br>

<button id="btnCopiarPix" class="btn-outline">
Copiar chave PIX
</button>
</div>

</div>

<button id="btnReservar" class="btn">
Reservar hor√°rio
</button>

</div>

</div>

<!-- ================= MODO BARBEIRO ================= -->

<div id="telaBarbeiro" class="hidden">

<div class="card">

<h3>Modo barbeiro</h3>

<label>Seu nome</label>
<select id="barbeiroModoSel"></select>

<label>Data</label>
<input type="date" id="barbeiroModoData">

<button id="btnVerAgendaBarbeiro" class="btn">
Ver minha agenda
</button>

<button id="btnVoltarCliente" class="btn-outline">
Voltar para cliente
</button>

</div>

<div class="card">
<h3>Clientes do dia</h3>
<div id="listaBarbeiroAgenda"></div>
</div>

</div>

<!-- ================= ADMIN ================= -->

<div id="telaAdmin" class="hidden">

<div class="card card-sub">
<h3>Painel administrador</h3>

<button id="btnLogout" class="btn-outline">
Sair do painel
</button>

</div>

<!-- ================= RELAT√ìRIOS ================= -->

<div class="card">

<h3>Relat√≥rios de vendas</h3>

<button id="btnRelHoje" class="relatorio-btn">
Relat√≥rio de hoje
</button>

<button id="btnRelPeriodo" class="btn-dark btn">
Relat√≥rio por per√≠odo
</button>

<div id="relatorioBox" class="card-sub hidden"
style="margin-top:16px"></div>

</div>
<!-- ================= SERVI√áOS ================= -->

<div class="card">
<h3>Servi√ßos</h3>

<input id="novoServicoNome" placeholder="Nome do servi√ßo">
<input id="novoServicoPreco" placeholder="Pre√ßo">

<button id="btnAddServico" class="btn">
Adicionar servi√ßo
</button>

<div id="adminServicos"></div>
</div>

<!-- ================= BARBEIROS ================= -->

<div class="card">
<h3>Barbeiros</h3>

<input id="novoBarbeiro" placeholder="Nome do barbeiro">

<button id="btnAddBarbeiro" class="btn">
Adicionar barbeiro
</button>

<div id="adminBarbeiros"></div>
</div>

<!-- ================= DISPONIBILIDADE ================= -->

<div class="card">
<h3>Disponibilidade por barbeiro</h3>

<label>Barbeiro</label>
<select id="adminBarbeiroSel"></select>

<label>Data</label>
<input type="date" id="adminDataPick">

<button id="btnGerarSlots" class="btn-dark btn">
Gerar hor√°rios
</button>

<div id="adminSlotsGrid" class="grid"></div>

<button id="btnSalvarSlotsDia" class="btn">
Salvar disponibilidade
</button>

<button id="btnLimparGerador" class="btn-outline">
Limpar sele√ß√£o
</button>

</div>

<!-- ================= RESET HOR√ÅRIOS ================= -->

<div class="card">

<h3>Gerenciar DISPONIBILIDADE (hor√°rios livres)</h3>

<button id="btnAbrirReset" class="btn-outline">
Abrir gerenciador de hor√°rios livres
</button>

<div id="resetBox" class="hidden">

<label>Barbeiro</label>
<select id="resetBarbeiro"></select>

<h4>Dias com hor√°rios livres</h4>
<div id="resetDias"></div>

<h4>Hor√°rios livres do dia</h4>
<div id="resetHorarios" class="grid"></div>

<button id="btnExcluirSlots" class="btn-danger btn">
Excluir hor√°rios livres selecionados
</button>

</div>

</div>

<!-- ================= EXCLUS√ÉO AGENDAMENTOS ================= -->

<div class="card">
<h3>Excluir AGENDAMENTOS de clientes</h3>

<button id="btnAbrirExclusao" class="btn-dark btn">
Abrir tela de exclus√£o de agendamentos
</button>
</div>

<div class="card">
<h3>Lista de agendamentos</h3>
<div id="listaAgendamentos"></div>
</div>

</div>

<!-- ================= TELA EXCLUS√ÉO ================= -->

<div id="telaExclusao" class="hidden">

<div class="card">

<h3>Excluir agendamentos</h3>

<label>Barbeiro</label>
<select id="excBarbeiro"></select>

<label>Data</label>
<input type="date" id="excData">

<button id="btnCarregarExc" class="btn">
Carregar
</button>

</div>

<div class="card">
<div id="listaExclusao"></div>
</div>

</div>

<!-- ================= FIREBASE ================= -->

<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>

<script>

const firebaseConfig = {
apiKey: "AIzaSyBDffb23AqSOoT-8Z94Ao9leB5nTSdIv78",
authDomain: "agenda-barbarujo.firebaseapp.com",
databaseURL: "https://agenda-barbarujo-default-rtdb.firebaseio.com/",
projectId: "agenda-barbarujo",
storageBucket: "agenda-barbarujo.firebasestorage.app",
messagingSenderId: "735138068544",
appId: "1:735138068544:web:5a1273bd8be9ef7ab487a5"
}

firebase.initializeApp(firebaseConfig)

const db = firebase.database()

const DB = {
servicos: db.ref("barbarujo/servicos"),
barbeiros: db.ref("barbarujo/barbeiros"),
config: db.ref("barbarujo/config"),
ag: db.ref("barbarujo/agendamentos"),
disp: db.ref("barbarujo/disponibilidade"),
vendas: db.ref("barbarujo/vendas")
}

// ================= ESTADO =================

let servicos=[]
let barbeiros=[]
let agendamentos=[]
let agendamentosMap={}
let disponibilidade={}

let servicoSel=null
let barbeiroSel=null
let dataSel=null
let horaSel=null
let pagamentoSel=null

let NOME_BARBEARIA="BARBARUJO"
const PIX_CHAVE="49999538762"

let config={intervalo:30}

</script>
<script>

// ================= HELPERS =================

function hojeISO(){
return new Date().toISOString().split("T")[0]
}

function rolarPara(el){
if(!el) return
setTimeout(()=>{
el.scrollIntoView({behavior:"smooth"})
},120)
}

function aplicarNome(){
topo.innerText="üíà "+NOME_BARBEARIA
document.title=NOME_BARBEARIA+" ‚Ä¢ Agendamento"
}

function formatarPreco(v){
return Number(v).toFixed(2).replace(".",",")
}

aplicarNome()

// ================= BACK =================

btnBack.onclick=()=>{

if(!telaExclusao.classList.contains("hidden")){
telaExclusao.classList.add("hidden")
telaAdmin.classList.remove("hidden")
return
}

if(!telaAdmin.classList.contains("hidden")){
telaAdmin.classList.add("hidden")
telaCliente.classList.remove("hidden")
return
}

if(!telaBarbeiro.classList.contains("hidden")){
telaBarbeiro.classList.add("hidden")
telaCliente.classList.remove("hidden")
return
}

document.querySelector(".container").style.display="none"
telaSplash.style.display="flex"
btnBack.classList.add("hidden")

}

// ================= SPLASH ‚Üí CLIENTE =================

btnEntrar.onclick=()=>{

telaSplash.style.display="none"
document.querySelector(".container").style.display="block"

telaCliente.classList.remove("hidden")
telaAdmin.classList.add("hidden")
telaBarbeiro.classList.add("hidden")
telaExclusao.classList.add("hidden")

btnBack.classList.remove("hidden")

}

// ================= SPLASH ‚Üí BARBEIRO =================

btnModoBarbeiro.onclick=()=>{

let s = prompt("Senha barbeiro")

if(s!=="barbeiro123"){
alert("Senha incorreta")
return
}

telaSplash.style.display="none"
document.querySelector(".container").style.display="block"

telaCliente.classList.add("hidden")
telaAdmin.classList.add("hidden")
telaExclusao.classList.add("hidden")
telaBarbeiro.classList.remove("hidden")

btnBack.classList.remove("hidden")
popularModoBarbeiro()

}

// ================= LOGIN ADMIN =================

btnAdminFab.onclick=()=>{

let s = prompt("Senha admin")

if(s!=="barbarujo123"){
if(s!==null) alert("Senha incorreta")
return
}

telaSplash.style.display="none"
document.querySelector(".container").style.display="block"

telaCliente.classList.add("hidden")
telaBarbeiro.classList.add("hidden")
telaExclusao.classList.add("hidden")
telaAdmin.classList.remove("hidden")

btnBack.classList.remove("hidden")

}

btnLogout.onclick=()=>{
telaAdmin.classList.add("hidden")
telaCliente.classList.remove("hidden")
}

// ================= TELEFONE INPUT =================

clienteFone.addEventListener("input",()=>{
clienteFone.value =
clienteFone.value.replace(/\D/g,"").slice(0,11)
})

</script>

<script>

// =====================================================
// ================= RENDER SERVI√áOS ===================
// =====================================================

function renderServicos(){

listaServicos.innerHTML=""

if(!servicos.length){
listaServicos.innerHTML="Sem servi√ßos cadastrados"
return
}

servicos.forEach(s=>{

let b=document.createElement("button")
b.className="btn"

b.innerHTML=`
<div style="font-size:16px;font-weight:800">
${s.nome}
</div>

<div class="price">
R$ ${formatarPreco(s.preco)}
</div>
`

b.onclick=()=>{

servicoSel=s
cardBarbeiro.classList.remove("hidden")
renderBarbeiros()
rolarPara(cardBarbeiro)

}

listaServicos.appendChild(b)

})

}

// =====================================================
// ================= RENDER BARBEIROS ==================
// =====================================================

function renderBarbeiros(){

listaBarbeiros.innerHTML=""

if(!barbeiros.length){
listaBarbeiros.innerHTML="Sem barbeiros cadastrados"
return
}

barbeiros.forEach(b=>{

let nome=b.nome||b

let btn=document.createElement("button")
btn.className="btn-outline"
btn.innerText=nome

btn.onclick=()=>{

barbeiroSel=nome
cardData.classList.remove("hidden")
renderDatasCliente()
rolarPara(cardData)

}

listaBarbeiros.appendChild(btn)

})

}

</script>
<script>

// =====================================================
// ================= DATAS CLIENTE =====================
// =====================================================

function renderDatasCliente(){

dataEscolhida.innerHTML=""

let diasObj = disponibilidade[barbeiroSel] || {}
let dias = Object.keys(diasObj).sort()

if(!dias.length){

let o=document.createElement("option")
o.textContent="Sem dias dispon√≠veis"
dataEscolhida.appendChild(o)
return

}

dias.forEach(d=>{
let o=document.createElement("option")
o.value=d
o.textContent=d
dataEscolhida.appendChild(o)
})

}

// =====================================================
// ================= CONFIRMAR DATA ====================
// =====================================================

btnConfirmarData.onclick=()=>{

dataSel = dataEscolhida.value

if(!dataSel){
alert("Escolha um dia")
return
}

renderHorariosCliente()
cardHorarios.classList.remove("hidden")
rolarPara(cardHorarios)

}

// =====================================================
// ================= HOR√ÅRIOS CLIENTE ==================
// =====================================================

function renderHorariosCliente(){

listaHorarios.innerHTML=""
horaSel=null

let lista =
(disponibilidade[barbeiroSel] &&
 disponibilidade[barbeiroSel][dataSel]) || []

if(!lista.length){
listaHorarios.innerHTML="Sem hor√°rios liberados"
return
}

lista.forEach(hora=>{

let div=document.createElement("div")
div.className="slot"
div.innerText=hora

let ocupado = agendamentos.find(a=>
a.data===dataSel &&
a.hora===hora &&
a.barbeiro===barbeiroSel
)

if(ocupado){
div.classList.add("booked")
}

div.onclick=()=>{

if(div.classList.contains("booked")) return

document
.querySelectorAll("#listaHorarios .slot")
.forEach(s=>s.classList.remove("selected"))

div.classList.add("selected")

horaSel=hora

cardCliente.classList.remove("hidden")
atualizarResumo()
rolarPara(cardCliente)

}

listaHorarios.appendChild(div)

})

}

// =====================================================
// ================= RESUMO ============================
// =====================================================

function atualizarResumo(){

resumoEscolha.innerHTML=`

<div class="card-sub" style="padding:16px;border-radius:14px">

<b>Servi√ßo:</b> ${servicoSel?.nome||"-"}<br>
<b>Barbeiro:</b> ${barbeiroSel||"-"}<br>
<b>Data:</b> ${dataSel||"-"}<br>
<b>Hora:</b> ${horaSel||"-"}<br>

<div class="price" style="margin-top:12px">
R$ ${formatarPreco(servicoSel?.preco||0)}
</div>

</div>

`

atualizarPagamentoBox()

}

// =====================================================
// ============ PAGAMENTO ‚Äî BOT√ïES VISUAIS ============
// =====================================================

function atualizarPagamentoBox(){

boxPagamento.classList.remove("hidden")

pixValorView.innerText =
formatarPreco(servicoSel?.preco||0)

pagamentoSel=null

document
.querySelectorAll(".pagamento-btn")
.forEach(b=>{

b.classList.remove("sel")

b.onclick=()=>{

document
.querySelectorAll(".pagamento-btn")
.forEach(x=>x.classList.remove("sel"))

b.classList.add("sel")

pagamentoSel = b.dataset.pg

if(pagamentoSel==="pix"){
pixInfo.classList.remove("hidden")
}else{
pixInfo.classList.add("hidden")
}

}

})

btnCopiarPix.onclick=()=>{
navigator.clipboard.writeText(PIX_CHAVE)
alert("Chave PIX copiada")
}

}

</script>
<script>

// =====================================================
// ================= WHATS LOJA FIXO ===================
// =====================================================

function enviarWhatsLoja(ag){

let msg =
`üíà BARBARUJO

Novo agendamento:

Cliente: ${ag.cliente}
Whats: ${ag.fone}
Servi√ßos: ${ag.servico}
Barbeiro: ${ag.barbeiro}
Data: ${ag.data}
Hora: ${ag.hora}
Pagamento: ${ag.pagamento}
Valor: R$ ${formatarPreco(ag.preco)}`

let url =
"https://wa.me/5549999538762?text="+encodeURIComponent(msg)

window.open(url,"_blank")

}

// =====================================================
// ================= REGISTRAR VENDA ===================
// =====================================================

function registrarVenda(ag){

let dia = ag.data

DB.vendas
.child(dia)
.push({
valor: ag.preco,
pagamento: ag.pagamento,
servico: ag.servico,
barbeiro: ag.barbeiro,
ts: ag.ts
})

}

// =====================================================
// ================= RESERVAR ==========================
// =====================================================

btnReservar.onclick = async ()=>{

if(!servicoSel || !barbeiroSel || !dataSel || !horaSel){
alert("Complete todas as escolhas")
return
}

if(!clienteNome.value || !clienteFone.value){
alert("Preencha nome e WhatsApp")
return
}

if(!pagamentoSel){
alert("Escolha a forma de pagamento")
return
}

let ag={
servico:servicoSel.nome,
preco:Number(servicoSel.preco),
barbeiro:barbeiroSel,
data:dataSel,
hora:horaSel,
cliente:clienteNome.value,
fone:clienteFone.value,
pagamento:pagamentoSel,
ts:Date.now()
}

await DB.ag.push(ag)

registrarVenda(ag)

enviarWhatsLoja(ag)

alert("Agendamento confirmado üíà")

location.reload()

}

</script>
<script>

// =====================================================
// ================= PAGAMENTO ‚Äî UI BOT√ïES =============
// =====================================================

document
.querySelectorAll(".pagamento-btn")
.forEach(btn=>{

btn.onclick=()=>{

document
.querySelectorAll(".pagamento-btn")
.forEach(b=>b.classList.remove("sel"))

btn.classList.add("sel")

pagamentoSel = btn.dataset.pg

if(pagamentoSel==="pix"){

pixInfo.classList.remove("hidden")

let valor = servicoSel ? Number(servicoSel.preco) : 0
pixValorView.innerText = formatarPreco(valor)

}else{
pixInfo.classList.add("hidden")
}

}

})

btnCopiarPix.onclick=()=>{

navigator.clipboard.writeText(PIX_CHAVE)
alert("Chave PIX copiada")

}

// =====================================================
// ================= RELAT√ìRIO ‚Äî BOT√ÉO HOJE ============
// =====================================================

btnRelHoje.onclick=()=>{

let hoje = hojeISO()

let lista = agendamentos.filter(a=>a.data===hoje)

renderRelatorioLista("HOJE "+hoje, lista)

relatorioBox.classList.remove("hidden")

rolarPara(relatorioBox)

}

// =====================================================
// ================= RELAT√ìRIO ‚Äî PER√çODO ===============
// =====================================================

btnRelPeriodo.onclick=()=>{

let ref = prompt("Digite:\n\nDia: 2026-02-10\nM√™s: 2026-02\nAno: 2026")

if(!ref) return

let lista = agendamentos.filter(a=>a.data.startsWith(ref))

renderRelatorioLista("PER√çODO "+ref, lista)

relatorioBox.classList.remove("hidden")

rolarPara(relatorioBox)

}

// =====================================================
// ================= RELAT√ìRIO ‚Äî RENDER ================
// =====================================================

function renderRelatorioLista(titulo,lista){

let total=0

let porTipo={
pix:0,
debito:0,
credito:0,
dinheiro:0
}

lista.forEach(a=>{

let v = Number(a.preco||0)

total+=v

if(a.pagamento && porTipo[a.pagamento]!=null){
porTipo[a.pagamento]+=v
}

})

relatorioBox.innerHTML=`

<h4>${titulo}</h4><br>

PIX: R$ ${formatarPreco(porTipo.pix)}<br>
D√©bito: R$ ${formatarPreco(porTipo.debito)}<br>
Cr√©dito: R$ ${formatarPreco(porTipo.credito)}<br>
Dinheiro: R$ ${formatarPreco(porTipo.dinheiro)}<br><br>

<b>TOTAL: R$ ${formatarPreco(total)}</b>

`

}

</script>
<script>

// =====================================================
// ============ ADMIN ‚Äî TEXTOS MAIS CLAROS =============
// =====================================================

// renomear t√≠tulos para evitar confus√£o visual (sem quebrar l√≥gica)

document.querySelectorAll("h3").forEach(h=>{

if(h.innerText.trim()==="Resetar hor√°rios"){
h.innerText="Remover hor√°rios liberados (DISPONIBILIDADE)"
}

if(h.innerText.trim()==="Excluir agendamentos"){
h.innerText="Cancelar agendamentos de clientes"
}

})

// =====================================================
// ========= ADMIN ‚Äî BOT√ïES VISUAIS DIFERENTES =========
// =====================================================

btnAbrirReset.classList.remove("btn-outline")
btnAbrirReset.classList.add("btn-dark")

btnAbrirExclusao.classList.remove("btn-dark")
btnAbrirExclusao.classList.add("btn-danger")

// =====================================================
// ===== CLIENTE ‚Äî GARANTIR PIX VALOR SEM EDI√á√ÉO =======
// =====================================================

// sempre recalcular valor exibido quando servi√ßo mudar

const _oldServicoClick = renderServicos

renderServicos = function(){

_oldServicoClick()

setTimeout(()=>{

document
.querySelectorAll("#listaServicos .btn")
.forEach(btn=>{

btn.addEventListener("click",()=>{

setTimeout(()=>{

if(pagamentoSel==="pix" && servicoSel){

pixValorView.innerText =
formatarPreco(servicoSel.preco)

}

},50)

})

})

},50)

}

// =====================================================
// ========= SEGURAN√áA ‚Äî VALOR N√ÉO EDIT√ÅVEL ============
// =====================================================

Object.defineProperty(window,"valorPixCliente",{
set(){},
get(){
return servicoSel ? servicoSel.preco : 0
}
})

</script>
<script>

// =====================================================
// ===== RELAT√ìRIO ‚Äî HOJE (BOT√ÉO ADMIN FUNCIONAL) =====
// =====================================================

btnRelHoje.onclick = ()=>{

let hoje = hojeISO()

let lista = agendamentos.filter(a=>a.data===hoje)

let total=0
let porTipo={
pix:0,
debito:0,
credito:0,
dinheiro:0
}

lista.forEach(a=>{
let v = Number(a.preco||0)
total += v
if(a.pagamento && porTipo[a.pagamento]!=null){
porTipo[a.pagamento]+=v
}
})

relatorioBox.classList.remove("hidden")

relatorioBox.innerHTML = `
<h4>Relat√≥rio de hoje ‚Äî ${hoje}</h4><br>

PIX: R$ ${formatarPreco(porTipo.pix)}<br>
D√©bito: R$ ${formatarPreco(porTipo.debito)}<br>
Cr√©dito: R$ ${formatarPreco(porTipo.credito)}<br>
Dinheiro: R$ ${formatarPreco(porTipo.dinheiro)}<br><br>

<b>Total: R$ ${formatarPreco(total)}</b><br><br>

Atendimentos: ${lista.length}
`

}

// =====================================================
// ===== RELAT√ìRIO ‚Äî PER√çODO (UI DIN√ÇMICA) =============
// =====================================================

btnRelPeriodo.onclick = ()=>{

relatorioBox.classList.remove("hidden")

relatorioBox.innerHTML = `

<h4>Relat√≥rio por per√≠odo</h4>

<select id="relTipo">
<option value="dia">Dia</option>
<option value="mes">M√™s</option>
<option value="ano">Ano</option>
</select>

<input id="relRef" placeholder="YYYY-MM ou YYYY-MM-DD">

<button id="btnRelRun" class="btn" style="margin-top:10px">
Gerar relat√≥rio
</button>

<div id="relOut" style="margin-top:16px"></div>

`

document.getElementById("btnRelRun").onclick = ()=>{

let tipo = document.getElementById("relTipo").value
let ref = document.getElementById("relRef").value

if(!ref){
alert("Informe a refer√™ncia")
return
}

let lista=[]

if(tipo==="dia"){
lista = agendamentos.filter(a=>a.data===ref)
}

if(tipo==="mes"){
lista = agendamentos.filter(a=>a.data.startsWith(ref))
}

if(tipo==="ano"){
lista = agendamentos.filter(a=>a.data.startsWith(ref))
}

let total=0
let porTipo={
pix:0,
debito:0,
credito:0,
dinheiro:0
}

lista.forEach(a=>{
let v=Number(a.preco||0)
total+=v
if(a.pagamento && porTipo[a.pagamento]!=null){
porTipo[a.pagamento]+=v
}
})

document.getElementById("relOut").innerHTML = `

PIX: R$ ${formatarPreco(porTipo.pix)}<br>
D√©bito: R$ ${formatarPreco(porTipo.debito)}<br>
Cr√©dito: R$ ${formatarPreco(porTipo.credito)}<br>
Dinheiro: R$ ${formatarPreco(porTipo.dinheiro)}<br><br>

<b>Total: R$ ${formatarPreco(total)}</b><br>
Atendimentos: ${lista.length}

`

}

}

</script>
<script>

// =====================================================
// ===== ADMIN ‚Äî UX MELHORADA EXCLUS√ïES (CLAREZA) =====
// =====================================================

// renomear visualmente t√≠tulos para n√£o confundir dono

document.addEventListener("DOMContentLoaded",()=>{

// bloco reset hor√°rios
let cards = document.querySelectorAll(".card h3")
cards.forEach(h=>{
if(h.innerText==="Resetar hor√°rios"){
h.innerText="Remover hor√°rios da agenda (DISPONIBILIDADE)"
}
if(h.innerText==="Excluir agendamentos"){
h.innerText="Excluir agendamentos de clientes (RESERVAS)"
}
})

})

// =====================================================
// ===== LABELS EXPLICATIVOS NOS BOT√ïES CR√çTICOS =======
// =====================================================

function aplicarLabelsAdmin(){

if(btnAbrirReset){
btnAbrirReset.innerText="Abrir gerenciador de HOR√ÅRIOS livres"
}

if(btnAbrirExclusao){
btnAbrirExclusao.innerText="Abrir tela de EXCLUS√ÉO de reservas"
}

if(btnExcluirSlots){
btnExcluirSlots.innerText="Remover hor√°rios selecionados"
}

}

setTimeout(aplicarLabelsAdmin,300)

// =====================================================
// ===== GARANTIR PIX ‚Äî VALOR SEMPRE ATUALIZADO =======
// =====================================================

function atualizarPixValorUI(){

let el = document.getElementById("pixValorView")
if(!el) return

let v = servicoSel ? servicoSel.preco : 0
el.innerText = formatarPreco(v)

}

const _oldAtualizarResumo2 = atualizarResumo
atualizarResumo = function(){
_oldAtualizarResumo2()
atualizarPixValorUI()
}

// =====================================================
// ===== PIX ‚Äî BOT√ÉO COPIAR CHAVE ======================
// =====================================================

document.addEventListener("click",e=>{

if(e.target && e.target.id==="btnCopiarPix"){
navigator.clipboard.writeText(PIX_CHAVE)
alert("Chave PIX copiada")
}

})

// =====================================================
// ===== PAGAMENTO ‚Äî BOT√ïES SELE√á√ÉO VISUAL ============
// =====================================================

document.addEventListener("click",e=>{

if(!e.target.classList.contains("pagamento-btn")) return

document
.querySelectorAll(".pagamento-btn")
.forEach(b=>b.classList.remove("sel"))

e.target.classList.add("sel")

pagamentoSel = e.target.dataset.pg

if(pagamentoSel==="pix"){
pixInfo.classList.remove("hidden")
atualizarPixValorUI()
}else{
pixInfo.classList.add("hidden")
}

})

// =====================================================
// ===== RESERVAR ‚Äî GARANTIR FORMA PAGAMENTO UI =======
// =====================================================

const _oldReservar = btnReservar.onclick

btnReservar.onclick = async ()=>{

if(!pagamentoSel){
alert("Selecione a forma de pagamento")
return
}

await _oldReservar()

}

// =====================================================
// ===== RELAT√ìRIO ‚Äî AUTO ATUALIZA AO ABRIR ADMIN ======
// =====================================================

const _oldAdminOpen = btnAdminFab.onclick

btnAdminFab.onclick = ()=>{
_oldAdminOpen()
setTimeout(()=>btnRelHoje.click(),400)
}

// =====================================================
// ===== LOG EXTRA FINAL ==============================
// =====================================================

console.log("ADMIN UX melhorado")
console.log("Pagamentos visuais OK")
console.log("PIX din√¢mico OK")
console.log("Relat√≥rios autom√°ticos OK")

</script>
<script>

// =====================================================
// ===== RELAT√ìRIO ‚Äî BOT√ÉO HOJE =======================
// =====================================================

btnRelHoje.onclick = ()=>{

relatorioBox.classList.remove("hidden")

let hoje = hojeISO()

let lista = agendamentos.filter(a=>a.data===hoje)

let total=0
let porTipo={
pix:0,
debito:0,
credito:0,
dinheiro:0
}

lista.forEach(a=>{
let v=Number(a.preco||0)
total+=v
if(a.pagamento && porTipo[a.pagamento]!=null){
porTipo[a.pagamento]+=v
}
})

relatorioBox.innerHTML = `

<div style="font-weight:900;margin-bottom:10px">
Relat√≥rio de hoje ‚Äî ${hoje}
</div>

PIX: R$ ${formatarPreco(porTipo.pix)}<br>
D√©bito: R$ ${formatarPreco(porTipo.debito)}<br>
Cr√©dito: R$ ${formatarPreco(porTipo.credito)}<br>
Dinheiro: R$ ${formatarPreco(porTipo.dinheiro)}<br><br>

<div class="price">
TOTAL R$ ${formatarPreco(total)}
</div>

`

}

// =====================================================
// ===== RELAT√ìRIO ‚Äî PER√çODO UI DIN√ÇMICA ==============
// =====================================================

btnRelPeriodo.onclick = ()=>{

relatorioBox.classList.remove("hidden")

relatorioBox.innerHTML = `

<h4>Relat√≥rio por per√≠odo</h4>

<select id="relTipoSel">
<option value="dia">Por dia</option>
<option value="mes">Por m√™s</option>
<option value="ano">Por ano</option>
</select>

<input id="relRefInput" type="date">

<button id="btnGerarRelPeriodo" class="btn" style="margin-top:10px">
Gerar relat√≥rio
</button>

<div id="relPeriodoResultado" style="margin-top:16px"></div>

`

setTimeout(()=>{

document
.getElementById("btnGerarRelPeriodo")
.onclick = gerarRelatorioPeriodoUI

},50)

}

// =====================================================
// ===== RELAT√ìRIO ‚Äî FUN√á√ÉO PER√çODO ===================
// =====================================================

function gerarRelatorioPeriodoUI(){

let tipo =
document.getElementById("relTipoSel").value

let ref =
document.getElementById("relRefInput").value

if(!ref){
alert("Escolha a data base")
return
}

let lista=[]

if(tipo==="dia"){
lista = agendamentos.filter(a=>a.data===ref)
}

if(tipo==="mes"){
let mes = ref.slice(0,7)
lista = agendamentos.filter(a=>a.data.startsWith(mes))
}

if(tipo==="ano"){
let ano = ref.slice(0,4)
lista = agendamentos.filter(a=>a.data.startsWith(ano))
}

let total=0
let porTipo={
pix:0,
debito:0,
credito:0,
dinheiro:0
}

lista.forEach(a=>{
let v=Number(a.preco||0)
total+=v
if(a.pagamento && porTipo[a.pagamento]!=null){
porTipo[a.pagamento]+=v
}
})

document.getElementById("relPeriodoResultado").innerHTML = `

<b>Resultado</b><br><br>

PIX: R$ ${formatarPreco(porTipo.pix)}<br>
D√©bito: R$ ${formatarPreco(porTipo.debito)}<br>
Cr√©dito: R$ ${formatarPreco(porTipo.credito)}<br>
Dinheiro: R$ ${formatarPreco(porTipo.dinheiro)}<br><br>

<div class="price">
TOTAL R$ ${formatarPreco(total)}
</div>

`

}

// =====================================================
// ===== MULTI-SERVI√áO ‚Äî PREPARA√á√ÉO BASE ==============
// =====================================================

let servicosSelecionados=[]

// intercepta clique servi√ßo para permitir multi sele√ß√£o

const _oldRenderServicos = renderServicos

renderServicos = function(){

_oldRenderServicos()

setTimeout(()=>{

document
.querySelectorAll("#listaServicos .btn")
.forEach((btn,i)=>{

btn.onclick = ()=>{

let s = servicos[i]

let idx = servicosSelecionados.findIndex(x=>x.nome===s.nome)

if(idx>=0){
servicosSelecionados.splice(idx,1)
btn.style.opacity=".5"
}else{
servicosSelecionados.push(s)
btn.style.opacity="1"
}

servicoSel = {
nome: servicosSelecionados.map(x=>x.nome).join(" + "),
preco: servicosSelecionados.reduce((t,x)=>t+Number(x.preco),0)
}

cardBarbeiro.classList.remove("hidden")
renderBarbeiros()
rolarPara(cardBarbeiro)

}

})

},50)

}

// =====================================================
// ===== MULTI ‚Äî GARANTIR PIX SOMA ====================
// =====================================================

const _oldAtualizarResumo3 = atualizarResumo
atualizarResumo = function(){
_oldAtualizarResumo3()
atualizarPixValorUI()
}

// =====================================================
// ===== LOG MULTI SERVI√áO ============================
// =====================================================

console.log("Multi-servi√ßo ativo")
console.log("Soma PIX autom√°tica OK")

</script>
<script>

// =====================================================
// ===== PAGAMENTO ‚Äî UI SELE√á√ÉO BOT√ïES =================
// =====================================================

document
.querySelectorAll(".pagamento-btn")
.forEach(btn=>{

btn.onclick = ()=>{

document
.querySelectorAll(".pagamento-btn")
.forEach(b=>b.classList.remove("sel"))

btn.classList.add("sel")

pagamentoSel = btn.dataset.pg

if(pagamentoSel==="pix"){
pixInfo.classList.remove("hidden")
}else{
pixInfo.classList.add("hidden")
}

atualizarPixValorUI()

}

})

// =====================================================
// ===== PIX ‚Äî ATUALIZAR VALOR AUTOM√ÅTICO ==============
// =====================================================

function atualizarPixValorUI(){

if(!servicoSel) return

let valor = Number(servicoSel.preco||0)

if(document.getElementById("pixValorView")){
pixValorView.innerText = formatarPreco(valor)
}

if(document.getElementById("pixChaveView")){
pixChaveView.innerText = PIX_CHAVE
}

}

// =====================================================
// ===== PIX ‚Äî COPIAR CHAVE ============================
// =====================================================

if(document.getElementById("btnCopiarPix")){

btnCopiarPix.onclick = ()=>{

navigator.clipboard.writeText(PIX_CHAVE)

alert("Chave PIX copiada")

}

}

// =====================================================
// ===== RESERVAR ‚Äî AJUSTE FINAL PAGAMENTO =============
// =====================================================

const _oldReservarClick = btnReservar.onclick

btnReservar.onclick = async ()=>{

if(!pagamentoSel){
alert("Selecione a forma de pagamento")
return
}

await _oldReservarClick()

}

// =====================================================
// ===== ADMIN ‚Äî CLAREZA BOT√ïES ========================
// =====================================================

document
.querySelectorAll("#telaAdmin h3")
.forEach(h=>{

if(h.innerText==="Resetar hor√°rios"){
h.innerText="Resetar hor√°rios DISPON√çVEIS"
}

if(h.innerText==="Excluir agendamentos"){
h.innerText="Excluir AGENDAMENTOS de clientes"
}

})

// =====================================================
// ===== ADMIN ‚Äî SUBT√çTULOS EXPLICATIVOS ===============
// =====================================================

const adminCards =
document.querySelectorAll("#telaAdmin .card")

adminCards.forEach(card=>{

if(card.innerHTML.includes("Disponibilidade por barbeiro")){

card.innerHTML =
card.innerHTML.replace(
"</h3>",
"</h3><div style='opacity:.7;font-size:13px;margin-bottom:8px'>Define hor√°rios que ficam LIBERADOS para agendar</div>"
)

}

if(card.innerHTML.includes("Resetar hor√°rios")){

card.innerHTML =
card.innerHTML.replace(
"</h3>",
"</h3><div style='opacity:.7;font-size:13px;margin-bottom:8px'>Remove hor√°rios liberados (n√£o apaga clientes)</div>"
)

}

if(card.innerHTML.includes("Excluir AGENDAMENTOS")){

card.innerHTML =
card.innerHTML.replace(
"</h3>",
"</h3><div style='opacity:.7;font-size:13px;margin-bottom:8px'>Apaga reservas feitas por clientes</div>"
)

}

})

// =====================================================
// ===== RELAT√ìRIO ‚Äî AUTO REFRESH ======================
// =====================================================

function atualizarRelatorioSeAberto(){

if(!relatorioBox.classList.contains("hidden")){
btnRelHoje.click()
}

}

setInterval(atualizarRelatorioSeAberto,15000)

// =====================================================
// ===== MULTI SERVI√áO ‚Äî RESET VISUAL ==================
// =====================================================

function limparSelecaoServicos(){

servicosSelecionados=[]
servicoSel=null

document
.querySelectorAll("#listaServicos .btn")
.forEach(b=>b.style.opacity="1")

}

// =====================================================
// ===== BACK ‚Äî LIMPAR MULTI ===========================
// =====================================================

const _oldBack = btnBack.onclick

btnBack.onclick = ()=>{

limparSelecaoServicos()
_oldBack()

}

// =====================================================
// ===== DEBUG FINAL BLOCO =============================
// =====================================================

console.log("Pagamento UI OK")
console.log("PIX UI OK")
console.log("Admin clareza OK")
console.log("Relat√≥rio auto OK")

</script>
<script>

// =====================================================
// ===== RELAT√ìRIO ‚Äî HOJE (BOT√ÉO VERDE) ================
// =====================================================

btnRelHoje.onclick = ()=>{

let hoje = hojeISO()

let lista = agendamentos.filter(a=>a.data===hoje)

let total=0

let porTipo={
pix:0,
debito:0,
credito:0,
dinheiro:0
}

lista.forEach(a=>{

let v = Number(a.preco||0)

total += v

if(a.pagamento && porTipo[a.pagamento]!=null){
porTipo[a.pagamento] += v
}

})

relatorioBox.classList.remove("hidden")

relatorioBox.innerHTML = `

<div style="font-weight:900;font-size:18px;margin-bottom:10px">
Relat√≥rio de hoje ‚Äî ${hoje}
</div>

<div class="grid">

<div class="card-sub">
PIX<br>
<b>R$ ${formatarPreco(porTipo.pix)}</b>
</div>

<div class="card-sub">
D√©bito<br>
<b>R$ ${formatarPreco(porTipo.debito)}</b>
</div>

<div class="card-sub">
Cr√©dito<br>
<b>R$ ${formatarPreco(porTipo.credito)}</b>
</div>

<div class="card-sub">
Dinheiro<br>
<b>R$ ${formatarPreco(porTipo.dinheiro)}</b>
</div>

</div>

<div class="price" style="margin-top:14px">
TOTAL R$ ${formatarPreco(total)}
</div>

`

}

// =====================================================
// ===== RELAT√ìRIO ‚Äî PER√çODO UI ========================
// =====================================================

btnRelPeriodo.onclick = ()=>{

relatorioBox.classList.remove("hidden")

relatorioBox.innerHTML = `

<div style="font-weight:900;margin-bottom:12px">
Relat√≥rio por per√≠odo
</div>

<select id="relTipo">
<option value="dia">Dia</option>
<option value="mes">M√™s</option>
<option value="ano">Ano</option>
</select>

<input id="relRef" placeholder="YYYY-MM ou YYYY ou YYYY-MM-DD">

<button id="btnRodarRelPeriodo" class="btn-dark btn">
Gerar relat√≥rio
</button>

<div id="relPeriodoResultado" style="margin-top:14px"></div>

`

document
.getElementById("btnRodarRelPeriodo")
.onclick = rodarRelatorioPeriodo

}

// =====================================================
// ===== RELAT√ìRIO ‚Äî PER√çODO ENGINE ====================
// =====================================================

function rodarRelatorioPeriodo(){

let tipo = document.getElementById("relTipo").value
let ref  = document.getElementById("relRef").value

if(!ref){
alert("Informe a refer√™ncia")
return
}

let lista=[]

if(tipo==="dia"){
lista = agendamentos.filter(a=>a.data===ref)
}

if(tipo==="mes"){
lista = agendamentos.filter(a=>a.data.startsWith(ref))
}

if(tipo==="ano"){
lista = agendamentos.filter(a=>a.data.startsWith(ref))
}

let total=0

let porTipo={
pix:0,
debito:0,
credito:0,
dinheiro:0
}

lista.forEach(a=>{

let v=Number(a.preco||0)

total += v

if(a.pagamento && porTipo[a.pagamento]!=null){
porTipo[a.pagamento]+=v
}

})

document.getElementById("relPeriodoResultado").innerHTML = `

<div class="grid">

<div class="card-sub">
PIX<br><b>R$ ${formatarPreco(porTipo.pix)}</b>
</div>

<div class="card-sub">
D√©bito<br><b>R$ ${formatarPreco(porTipo.debito)}</b>
</div>

<div class="card-sub">
Cr√©dito<br><b>R$ ${formatarPreco(porTipo.credito)}</b>
</div>

<div class="card-sub">
Dinheiro<br><b>R$ ${formatarPreco(porTipo.dinheiro)}</b>
</div>

</div>

<div class="price" style="margin-top:12px">
TOTAL R$ ${formatarPreco(total)}
</div>

`

}

// =====================================================
// ===== PAGAMENTO ‚Äî RESET AO TROCAR HOR√ÅRIO ===========
// =====================================================

function resetPagamento(){

pagamentoSel=null

document
.querySelectorAll(".pagamento-btn")
.forEach(b=>b.classList.remove("sel"))

if(pixInfo){
pixInfo.classList.add("hidden")
}

}

// =====================================================
// ===== HOR√ÅRIO CLICK ‚Äî INJETAR RESET PAGAMENTO =======
// =====================================================

const _oldRenderHorarios = renderHorariosCliente

renderHorariosCliente = function(){

_oldRenderHorarios()

document
.querySelectorAll("#listaHorarios .slot")
.forEach(s=>{

let old = s.onclick

s.onclick = ()=>{
resetPagamento()
old()
}

})

}

// =====================================================
// ===== DEBUG BLOCO FINAL =============================
// =====================================================

console.log("Relat√≥rio hoje OK")
console.log("Relat√≥rio per√≠odo OK")
console.log("Reset pagamento OK")

</script>
<script>

// =====================================================
// ===== ADMIN UX ‚Äî RENOMEAR A√á√ïES CONFUSAS ============
// =====================================================

// melhora texto dos bot√µes sem mudar IDs nem l√≥gica

setTimeout(()=>{

if(btnExcluirSlots){
btnExcluirSlots.innerText = "Excluir hor√°rios selecionados"
}

let resetCardTitle = document
.querySelector("#resetBox")
?.parentElement
?.querySelector("h3")

if(resetCardTitle){
resetCardTitle.innerText = "Gerenciar hor√°rios dispon√≠veis"
}

},300)

// =====================================================
// ===== ADMIN ‚Äî TOOLTIP VISUAL SIMPLES ================
// =====================================================

function addHint(el,txt){

if(!el) return

el.title = txt

}

setTimeout(()=>{

addHint(btnGerarSlots,"Gerar grade base de hor√°rios do dia")
addHint(btnSalvarSlotsDia,"Salvar hor√°rios liberados para clientes")
addHint(btnLimparGerador,"Limpar sele√ß√£o de hor√°rios")
addHint(btnAbrirReset,"Abrir gerenciador de hor√°rios j√° salvos")
addHint(btnAbrirExclusao,"Abrir tela s√≥ para excluir agendamentos")

},400)

// =====================================================
// ===== PAGAMENTO ‚Äî UI BOT√ïES (BASE J√Å EXISTE) ========
// =====================================================

document
.querySelectorAll(".pagamento-btn")
.forEach(btn=>{

btn.onclick=()=>{

document
.querySelectorAll(".pagamento-btn")
.forEach(b=>b.classList.remove("sel"))

btn.classList.add("sel")

pagamentoSel = btn.dataset.pg

if(pagamentoSel==="pix"){

pixInfo.classList.remove("hidden")

pixChaveView.innerText = PIX_CHAVE

let valor = servicoSel ? servicoSel.preco : 0

pixValorView.innerText = formatarPreco(valor)

}else{

pixInfo.classList.add("hidden")

}

}

})

// =====================================================
// ===== PIX ‚Äî COPIAR CHAVE ============================
// =====================================================

if(btnCopiarPix){

btnCopiarPix.onclick=()=>{

navigator.clipboard.writeText(PIX_CHAVE)

alert("Chave PIX copiada")

}

}

// =====================================================
// ===== RESERVAR ‚Äî GARANTIR PAGAMENTO UI ==============
// =====================================================

const _oldReservar = btnReservar.onclick

btnReservar.onclick = async ()=>{

if(!pagamentoSel){

// fallback para radio antigo se existir
let r = document.querySelector("input[name=pgto]:checked")
if(r){
pagamentoSel = r.value
}

}

if(!pagamentoSel){
alert("Escolha a forma de pagamento")
return
}

// for√ßa pre√ßo correto no PIX visual
if(pagamentoSel==="pix" && servicoSel){
pixValorView.innerText = formatarPreco(servicoSel.preco)
}

await _oldReservar()

}

// =====================================================
// ===== RELAT√ìRIO ‚Äî AUTO REFRESH VISUAL ===============
// =====================================================

DB.ag.on("value",()=>{

if(!relatorioBox.classList.contains("hidden")){

// se estiver aberto, recalcula hoje
if(relatorioBox.innerText.includes("Relat√≥rio de hoje")){
btnRelHoje.onclick()
}

}

})

// =====================================================
// ===== INTEGRIDADE BASE ‚Äî LOG ========================
// =====================================================

console.log("UX admin melhorada")
console.log("Pagamento visual OK")
console.log("PIX chave fixa OK")
console.log("Base oficial preservada")

</script>

</div>
</body>
</html>
