<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>BARBARUJO ‚Ä¢ Agendamento</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0e0e0e">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">

<style>

*{
margin:0;
padding:0;
box-sizing:border-box;
font-family:Poppins,sans-serif
}

body{
background:#0e0e0e;
color:#fff;
}

/* ================= HEADER ================= */

header{
background:#111;
padding:22px;
text-align:center;
font-size:26px;
font-weight:700;
border-bottom:2px solid #222;
position:sticky;
top:0;
z-index:50;
}

/* ================= CONTAINER ================= */

.container{
max-width:960px;
margin:auto;
padding:26px 18px 80px 18px;
display:none;
}

/* ================= CARDS ================= */

.card{
background:#181818;
border-radius:18px;
padding:26px;
margin-bottom:28px;
box-shadow:0 0 22px rgba(0,0,0,.35);
transition:.25s;
}

.card-sub{
background:#141414;
border:1px solid #262626;
}

.card h3{
margin-bottom:18px;
font-size:20px;
letter-spacing:.3px;
}

/* ================= GRID ================= */

.grid{
display:grid;
grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
gap:14px;
}

/* ================= BOT√ïES ================= */

.btn{
background:#d4af37;
border:none;
padding:16px;
border-radius:14px;
font-weight:700;
width:100%;
cursor:pointer;
color:#000;
font-size:15px;
}

.btn:hover{filter:brightness(1.05)}

.btn-outline{
background:transparent;
border:2px solid #d4af37;
color:#d4af37;
padding:14px;
border-radius:14px;
width:100%;
cursor:pointer;
font-weight:700;
}

.btn-dark{
background:#2a2a2a;
border:1px solid #333;
color:#fff;
}

.btn-danger{
background:#402020;
border:2px solid #803030;
color:#ffb3b3;
}

/* ================= INPUTS ================= */

input,select{
width:100%;
padding:14px;
border-radius:12px;
border:none;
margin-top:8px;
margin-bottom:12px;
color:#000;
font-size:15px;
}

/* ================= SLOTS ================= */

.slot{
background:#222;
padding:14px;
border-radius:12px;
text-align:center;
cursor:pointer;
font-weight:700;
transition:.15s;
}

.slot:hover{
transform:translateY(-2px);
}

.slot.booked{
background:#402020;
opacity:.45;
pointer-events:none;
}

.slot.selected{
outline:3px solid #d4af37;
background:#2c2612;
}

/* ================= BADGE ================= */

.badge{
background:#d4af37;
color:#000;
padding:5px 10px;
border-radius:999px;
font-size:12px;
font-weight:700;
}

/* ================= SPLASH ================= */

.splash{
position:fixed;
inset:0;
background:#0e0e0e;
display:flex;
flex-direction:column;
align-items:center;
justify-content:center;
z-index:9999;
padding:24px;
text-align:center;
}

.splash-logo{
width:78vw;
max-width:520px;
min-width:260px;
margin-bottom:26px;
border-radius:28px;
box-shadow:0 0 60px rgba(0,0,0,.85);
transform:translateX(-6%);
}

/* ================= ADMIN FAB ================= */

.admin-fab{
position:fixed;
top:16px;
right:16px;
width:54px;
height:54px;
border-radius:50%;
background:#d4af37;
color:#000;
display:flex;
align-items:center;
justify-content:center;
font-size:24px;
font-weight:900;
z-index:99999;
box-shadow:0 6px 22px rgba(0,0,0,.55);
cursor:pointer;
}

/* ================= UX STEP ================= */

.step{
font-size:13px;
opacity:.7;
margin-bottom:6px;
letter-spacing:.4px;
}

.hidden{display:none}

</style>
</head>
<body>

<!-- ================= ADMIN FAB ================= -->

<div id="btnAdminFab" class="admin-fab">‚öôÔ∏è</div>

<!-- ================= SPLASH ================= -->

<div id="telaSplash" class="splash">

<img src="logo.png" class="splash-logo">

<h1 style="font-size:36px;margin-bottom:18px">
üíà BARBARUJO
</h1>

<button id="btnEntrar" class="btn" style="max-width:360px">
Agende seu hor√°rio
</button>

</div>

<!-- ================= HEADER ================= -->

<header id="topo">üíà BARBARUJO</header>

<div class="container">

<!-- ===================================================== -->
<!-- ===================== CLIENTE ======================= -->
<!-- ===================================================== -->

<div id="telaCliente">

<!-- ========= SERVI√áOS ========= -->

<div class="card" id="cardServico">
<div class="step">PASSO 1</div>
<h3>Escolha o servi√ßo</h3>

<div id="listaServicos" class="grid"></div>
</div>

<!-- ========= BARBEIRO ========= -->

<div id="cardBarbeiro" class="card hidden">
<div class="step">PASSO 2</div>
<h3>Escolha o barbeiro</h3>

<div id="listaBarbeiros" class="grid"></div>
</div>

<!-- ========= DATA ========= -->

<div id="cardData" class="card hidden">
<div class="step">PASSO 3</div>
<h3>Escolha o dia dispon√≠vel</h3>

<select id="dataEscolhida"></select>

<button id="btnConfirmarData" class="btn-dark btn">
Ver hor√°rios deste dia
</button>

</div>

<!-- ========= HOR√ÅRIOS ========= -->

<div id="cardHorarios" class="card hidden">
<div class="step">PASSO 4</div>
<h3>Escolha o hor√°rio dispon√≠vel</h3>

<div id="listaHorarios" class="grid"></div>
</div>

<!-- ========= CONFIRMA√á√ÉO ========= -->

<div id="cardCliente" class="card hidden">

<div class="step">PASSO 5</div>
<h3>Confirmar reserva</h3>

<div id="resumoEscolha" style="line-height:1.8"></div>

<input id="clienteNome" placeholder="Seu nome">
<input id="clienteFone" placeholder="WhatsApp">

<button id="btnReservar" class="btn">
Reservar hor√°rio
</button>

<button id="btnConfirmar" class="btn-outline hidden">
Confirmar agendamento
</button>

</div>

</div>
<!-- ===================================================== -->
<!-- ======================= ADMIN ======================= -->
<!-- ===================================================== -->

<div id="telaAdmin" class="hidden">

<!-- ========= CABE√áALHO ADMIN ========= -->

<div class="card card-sub">
<h3>Painel Administrador</h3>
<button id="btnLogout" class="btn-outline">Sair do painel</button>
</div>

<!-- ========= SERVI√áOS ========= -->

<div class="card">
<h3>Servi√ßos</h3>

<input id="novoServicoNome" placeholder="Nome do servi√ßo">
<input id="novoServicoPreco" placeholder="Pre√ßo">

<button id="btnAddServico" class="btn">Adicionar servi√ßo</button>

<div id="adminServicos"></div>
</div>

<!-- ========= BARBEIROS ========= -->

<div class="card">
<h3>Barbeiros</h3>

<input id="novoBarbeiro" placeholder="Nome do barbeiro">

<button id="btnAddBarbeiro" class="btn">Adicionar barbeiro</button>

<div id="adminBarbeiros"></div>
</div>

<!-- ========= CONFIG BASE ========= -->

<div class="card">
<h3>Hor√°rio base da barbearia</h3>

<label>Abertura</label>
<input type="time" id="cfgAbertura">

<label>Fechamento</label>
<input type="time" id="cfgFechamento">

<label>Intervalo</label>
<select id="cfgIntervalo">
<option value="15">15 min</option>
<option value="30">30 min</option>
<option value="45">45 min</option>
<option value="60">60 min</option>
</select>

<button id="btnSalvarCfg" class="btn">
Salvar configura√ß√£o base
</button>
</div>

<!-- ===================================================== -->
<!-- ========= DISPONIBILIDADE ‚Äî MODO ETAPAS ========= -->
<!-- ===================================================== -->

<div class="card">
<h3>Disponibilidade por barbeiro</h3>

<div class="step">PASSO 1 ‚Äî Barbeiro</div>
<select id="adminBarbeiroSel"></select>

<div class="step">PASSO 2 ‚Äî Data</div>
<input type="date" id="adminDataPick">

<button id="btnGerarSlots" class="btn-dark btn">
Gerar hor√°rios do dia
</button>

<div id="adminSlotsGrid" class="grid"></div>

<button id="btnSalvarSlotsDia" class="btn">
Salvar disponibilidade
</button>

<button id="btnLimparGerador" class="btn-outline">
Limpar sele√ß√£o atual
</button>

</div>

<!-- ===================================================== -->
<!-- ========= RESET AVAN√áADO ‚Äî COLAPS√ÅVEL ========= -->
<!-- ===================================================== -->

<div class="card">

<h3>Gerenciar / Resetar hor√°rios</h3>

<button id="btnAbrirReset" class="btn-outline">
Abrir gerenciador de hor√°rios
</button>

<div id="resetBox" class="hidden" style="margin-top:18px">

<div class="step">Barbeiro</div>
<select id="resetBarbeiro"></select>

<div id="resetDias"></div>
<div id="resetHorarios" class="grid"></div>

<button id="btnExcluirSlots" class="btn-danger btn">
Excluir hor√°rios selecionados
</button>

</div>

</div>

<!-- ===================================================== -->
<!-- ========= FERRAMENTAS ========= -->
<!-- ===================================================== -->

<div class="card">
<h3>Ferramentas</h3>

<button id="btnExportarDia" class="btn">
Copiar agenda do dia
</button>

<button id="btnSetup" class="btn-dark btn">
Setup r√°pido
</button>

<button id="btnDemo" class="btn-dark btn">
Criar demo
</button>

<button id="btnInstalarApp" class="btn">
Instalar como app
</button>

</div>

<!-- ========= AGENDAMENTOS ========= -->

<div class="card">
<h3>Agendamentos</h3>
<div id="listaAgendamentos"></div>
</div>

</div>
<!-- ================= FIREBASE ================= -->

<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>

<script>

// =========================
// CONFIG FIREBASE
// =========================

const firebaseConfig = {
apiKey: "AIzaSyBDffb23AqSOoT-8Z94Ao9leB5nTSdIv78",
authDomain: "agenda-barbarujo.firebaseapp.com",
databaseURL: "https://agenda-barbarujo-default-rtdb.firebaseio.com/",
projectId: "agenda-barbarujo",
storageBucket: "agenda-barbarujo.firebasestorage.app",
messagingSenderId: "735138068544",
appId: "1:735138068544:web:5a1273bd8be9ef7ab487a5"
}

firebase.initializeApp(firebaseConfig)

const db = firebase.database()

// =========================
// REFER√äNCIAS DB
// =========================

const DB = {
servicos: db.ref("barbarujo/servicos"),
barbeiros: db.ref("barbarujo/barbeiros"),
config: db.ref("barbarujo/config"),
ag: db.ref("barbarujo/agendamentos"),
disp: db.ref("barbarujo/disponibilidade") // barbeiro ‚Üí data ‚Üí horarios
}

// =========================
// ESTADO GLOBAL
// =========================

let servicos=[]
let barbeiros=[]
let agendamentos=[]

/*
disponibilidade formato:

{
  barbeiro: {
    data: ["08:00","08:30"]
  }
}
*/

let disponibilidade={}

let config={
abertura:"08:00",
fechamento:"18:00",
intervalo:30
}

let servicoSel=null
let barbeiroSel=null
let dataSel=null
let horaSel=null

let salvando=false

let NOME_BARBEARIA="BARBARUJO"
let WHATS_BARBEARIA="5599999999999"

const ADMIN_SENHA="barbarujo123"

// =========================
// HELPERS UX
// =========================

function hojeISO(){
return new Date().toISOString().split("T")[0]
}

function rolarPara(el){
setTimeout(()=>{
el.scrollIntoView({behavior:"smooth",block:"start"})
},120)
}

function aplicarNome(){
topo.innerText="üíà "+NOME_BARBEARIA
document.title=NOME_BARBEARIA+" ‚Ä¢ Agendamento"
}

aplicarNome()

// =========================
// SPLASH
// =========================

btnEntrar.onclick=()=>{
telaSplash.style.display="none"
document.querySelector(".container").style.display="block"
rolarPara(cardServico)
}

// =========================
// TELEFONE M√ÅSCARA
// =========================

clienteFone.addEventListener("input",()=>{
clienteFone.value =
clienteFone.value.replace(/\D/g,"").slice(0,11)
})

// =========================
// ADMIN FAB
// =========================

function abrirAdmin(){

let s=prompt("Senha admin")

if(s===ADMIN_SENHA){
telaCliente.classList.add("hidden")
telaAdmin.classList.remove("hidden")
rolarPara(telaAdmin)
}else if(s!==null){
alert("Senha incorreta")
}

}

btnAdminFab.onclick=abrirAdmin
btnLogout.onclick=()=>{
telaAdmin.classList.add("hidden")
telaCliente.classList.remove("hidden")
}

// =========================
// PWA INSTALL
// =========================

let deferredPrompt=null

window.addEventListener("beforeinstallprompt",e=>{
e.preventDefault()
deferredPrompt=e
})

btnInstalarApp.onclick=()=>{
if(!deferredPrompt){
alert("Instala√ß√£o n√£o dispon√≠vel agora")
return
}
deferredPrompt.prompt()
}

</script>
<script>

// =========================
// RENDER SERVI√áOS ‚Äî CLIENTE
// =========================

function renderServicos(){

listaServicos.innerHTML=""

servicos.forEach(s=>{

let b=document.createElement("button")
b.className="btn"

b.innerHTML = `
${s.nome}
<br>
<span class="badge">R$ ${s.preco}</span>
`

b.onclick=()=>{

servicoSel=s

cardBarbeiro.classList.remove("hidden")
renderBarbeiros()
atualizarResumo()

rolarPara(cardBarbeiro)

}

listaServicos.appendChild(b)

})

}

// =========================
// RENDER BARBEIROS ‚Äî CLIENTE
// =========================

function renderBarbeiros(){

listaBarbeiros.innerHTML=""

barbeiros.forEach(nome=>{

let b=document.createElement("button")
b.className="btn-outline"
b.innerText=nome

b.onclick=()=>{

barbeiroSel=nome

cardData.classList.remove("hidden")
renderDatasCliente()
atualizarResumo()

rolarPara(cardData)

}

listaBarbeiros.appendChild(b)

})

}

// =========================
// RENDER DATAS ‚Äî CLIENTE
// =========================

function renderDatasCliente(){

dataEscolhida.innerHTML=""
dataSel=null
horaSel=null

if(!barbeiroSel) return

let diasObj = disponibilidade[barbeiroSel] || {}
let dias = Object.keys(diasObj).sort()

if(dias.length===0){
let opt=document.createElement("option")
opt.textContent="Sem dias dispon√≠veis"
dataEscolhida.appendChild(opt)
return
}

dias.forEach(d=>{
let opt=document.createElement("option")
opt.value=d
opt.textContent=d
dataEscolhida.appendChild(opt)
})

}

// =========================
// CLIENTE ‚Äî CONFIRMAR DATA
// =========================

btnConfirmarData.onclick=()=>{

if(!barbeiroSel){
alert("Escolha o barbeiro")
return
}

if(!dataEscolhida.value){
alert("Escolha a data")
return
}

dataSel=dataEscolhida.value

cardHorarios.classList.remove("hidden")
renderHorariosCliente()
atualizarResumo()

rolarPara(cardHorarios)

}

// =========================
// RESUMO ESCOLHA
// =========================

function atualizarResumo(){

resumoEscolha.innerHTML = `
<span class="badge">Servi√ßo</span> ${servicoSel?.nome||"-"}<br>
<span class="badge">Barbeiro</span> ${barbeiroSel||"-"}<br>
<span class="badge">Data</span> ${dataSel||"-"}<br>
<span class="badge">Hora</span> ${horaSel||"-"}
`

}

</script>
<script>

// =========================
// RENDER HOR√ÅRIOS ‚Äî CLIENTE
// =========================

function renderHorariosCliente(){

listaHorarios.innerHTML=""
horaSel=null

if(!barbeiroSel || !dataSel) return

let lista = (disponibilidade[barbeiroSel] &&
             disponibilidade[barbeiroSel][dataSel]) || []

if(lista.length===0){
listaHorarios.innerHTML="<div>Nenhum hor√°rio dispon√≠vel</div>"
return
}

lista.forEach(hora=>{

let div=document.createElement("div")
div.className="slot"
div.innerText=hora

// ===== VERIFICAR CONFLITO =====

let ocupado = agendamentos.find(a =>
a.data===dataSel &&
a.hora===hora &&
a.barbeiro===barbeiroSel
)

if(ocupado){
div.classList.add("booked")
}

// ===== CLICK =====

div.onclick=()=>{

if(div.classList.contains("booked")) return

document
.querySelectorAll("#listaHorarios .slot")
.forEach(s=>s.classList.remove("selected"))

div.classList.add("selected")

horaSel=hora

cardCliente.classList.remove("hidden")
atualizarResumo()

rolarPara(cardCliente)

}

listaHorarios.appendChild(div)

})

}

// =========================
// RESERVAR ‚Äî ETAPA 1
// =========================

btnReservar.onclick=()=>{

if(!servicoSel || !barbeiroSel || !dataSel || !horaSel){
alert("Complete todas as escolhas")
return
}

if(!clienteNome.value || !clienteFone.value){
alert("Preencha nome e WhatsApp")
return
}

btnReservar.classList.add("hidden")
btnConfirmar.classList.remove("hidden")

alert("Confirme o agendamento")

}

// =========================
// WHATSAPP LOJA
// =========================

function enviarWhatsLoja(ag){

let msg=`üíà NOVO AGENDAMENTO
Cliente: ${ag.cliente}
Whats: ${ag.fone}
Servi√ßo: ${ag.servico}
Barbeiro: ${ag.barbeiro}
Data: ${ag.data}
Hora: ${ag.hora}`

let url="https://wa.me/"+WHATS_BARBEARIA+
"?text="+encodeURIComponent(msg)

window.open(url,"_blank")

}

// =========================
// CONFIRMAR ‚Äî ETAPA FINAL
// =========================

btnConfirmar.onclick=async()=>{

if(salvando) return
salvando=true

if(!confirm("Confirmar agendamento?")){
salvando=false
return
}

// ===== ANTI CONFLITO REALTIME =====

let snap = await DB.ag
.orderByChild("data")
.equalTo(dataSel)
.get()

let conflito=false

snap.forEach(c=>{
let a=c.val()
if(a.hora===horaSel && a.barbeiro===barbeiroSel){
conflito=true
}
})

if(conflito){
alert("Hor√°rio j√° ocupado")
renderHorariosCliente()
salvando=false
return
}

// ===== SALVAR =====

let ag={
servico:servicoSel.nome,
preco:servicoSel.preco,
barbeiro:barbeiroSel,
data:dataSel,
hora:horaSel,
cliente:clienteNome.value,
fone:clienteFone.value,
ts:Date.now()
}

await DB.ag.push(ag)

enviarWhatsLoja(ag)

alert("Agendamento confirmado üíà")

location.reload()

}

</script>
<script>

// =========================
// ADMIN ‚Äî POPULAR SELECTS BARBEIRO
// =========================

function popularSelectsBarbeiro(){

adminBarbeiroSel.innerHTML=""
resetBarbeiro.innerHTML=""

barbeiros.forEach(b=>{

let o1=document.createElement("option")
o1.value=b
o1.textContent=b
adminBarbeiroSel.appendChild(o1)

let o2=document.createElement("option")
o2.value=b
o2.textContent=b
resetBarbeiro.appendChild(o2)

})

}

// =========================
// ADMIN ‚Äî GERAR SLOTS DO DIA
// =========================

btnGerarSlots.onclick=()=>{

let barbeiro = adminBarbeiroSel.value
let data = adminDataPick.value

if(!barbeiro){
alert("Escolha o barbeiro")
return
}

if(!data){
alert("Escolha a data")
return
}

let ja = (disponibilidade[barbeiro] &&
          disponibilidade[barbeiro][data]) || []

let [ha,ma]=config.abertura.split(":").map(Number)
let [hf,mf]=config.fechamento.split(":").map(Number)

let ini=ha*60+ma
let fim=hf*60+mf
let intervalo=Number(config.intervalo)

adminSlotsGrid.innerHTML=""

for(let t=ini;t<fim;t+=intervalo){

let h=Math.floor(t/60).toString().padStart(2,"0")
let m=(t%60).toString().padStart(2,"0")
let hora=h+":"+m

let div=document.createElement("div")
div.className="slot"
div.innerText=hora

if(ja.includes(hora)){
div.classList.add("selected")
}

div.onclick=()=>div.classList.toggle("selected")

adminSlotsGrid.appendChild(div)

}

rolarPara(adminSlotsGrid)

}

// =========================
// ADMIN ‚Äî SALVAR DISPONIBILIDADE
// =========================

btnSalvarSlotsDia.onclick=async()=>{

let barbeiro = adminBarbeiroSel.value
let data = adminDataPick.value

if(!barbeiro || !data){
alert("Escolha barbeiro e data")
return
}

let sel=[]
document
.querySelectorAll("#adminSlotsGrid .slot.selected")
.forEach(s=>sel.push(s.innerText))

if(sel.length===0){
alert("Selecione hor√°rios")
return
}

if(!confirm("Salvar disponibilidade deste dia?")){
return
}

await DB.disp
.child(barbeiro)
.child(data)
.set(sel)

alert("Disponibilidade salva ‚úÖ")

adminSlotsGrid.innerHTML=""
adminDataPick.value=""

}

// =========================
// ADMIN ‚Äî LIMPAR GERADOR
// =========================

btnLimparGerador.onclick=()=>{

if(!confirm("Limpar sele√ß√£o atual?")) return

adminSlotsGrid.innerHTML=""
adminDataPick.value=""

}

</script>
<script>

// =========================
// RESET ‚Äî ABRIR / FECHAR
// =========================

btnAbrirReset.onclick=()=>{

resetBox.classList.toggle("hidden")

if(!resetBox.classList.contains("hidden")){
renderResetDias()
}

}

// =========================
// RESET ‚Äî DIAS DO BARBEIRO
// =========================

function renderResetDias(){

resetDias.innerHTML=""
resetHorarios.innerHTML=""

let barbeiro = resetBarbeiro.value
if(!barbeiro) return

let diasObj = disponibilidade[barbeiro] || {}
let dias = Object.keys(diasObj).sort()

if(dias.length===0){
resetDias.innerHTML="<div>Nenhum dia cadastrado</div>"
return
}

dias.forEach(d=>{

let btn=document.createElement("button")
btn.className="btn-dark btn"
btn.style.marginBottom="10px"
btn.textContent=d

btn.onclick=()=>{

document
.querySelectorAll("#resetDias button")
.forEach(b=>b.classList.remove("selected"))

btn.classList.add("selected")

renderResetHorarios(barbeiro,d)

}

resetDias.appendChild(btn)

})

}

resetBarbeiro.onchange=renderResetDias

// =========================
// RESET ‚Äî HOR√ÅRIOS DO DIA
// =========================

function renderResetHorarios(barbeiro,data){

resetHorarios.innerHTML=""

let lista = (disponibilidade[barbeiro] &&
             disponibilidade[barbeiro][data]) || []

if(lista.length===0){
resetHorarios.innerHTML="<div>Sem hor√°rios</div>"
return
}

lista.forEach(h=>{

let div=document.createElement("div")
div.className="slot"
div.innerText=h

div.onclick=()=>div.classList.toggle("selected")

resetHorarios.appendChild(div)

})

resetHorarios.dataset.barbeiro=barbeiro
resetHorarios.dataset.data=data

rolarPara(resetHorarios)

}

// =========================
// RESET ‚Äî EXCLUIR SELECIONADOS
// =========================

btnExcluirSlots.onclick=async()=>{

let barbeiro = resetHorarios.dataset.barbeiro
let data = resetHorarios.dataset.data

if(!barbeiro || !data){
alert("Escolha barbeiro e dia")
return
}

let remover=[]
document
.querySelectorAll("#resetHorarios .slot.selected")
.forEach(s=>remover.push(s.innerText))

if(remover.length===0){
alert("Selecione hor√°rios para excluir")
return
}

if(!confirm("Excluir hor√°rios selecionados?")){
return
}

let atuais = (disponibilidade[barbeiro] &&
              disponibilidade[barbeiro][data]) || []

let novos = atuais.filter(h=>!remover.includes(h))

await DB.disp
.child(barbeiro)
.child(data)
.set(novos)

alert("Hor√°rios removidos com sucesso ‚úÖ")

renderResetDias()

}

</script>
<script>

// =========================
// SYNC SERVI√áOS
// =========================

DB.servicos.on("value",snap=>{

if(snap.exists()){
servicos = Object.values(snap.val())
}else{
DB.servicos.set([
{nome:"Corte",preco:40},
{nome:"Barba",preco:30},
{nome:"Combo",preco:65}
])
return
}

renderServicos()
renderAdminServicos()

})

// =========================
// SYNC BARBEIROS
// =========================

DB.barbeiros.on("value",snap=>{

if(snap.exists()){
barbeiros = Object.values(snap.val())
}else{
DB.barbeiros.set(["Carlos","Pedro"])
return
}

renderAdminBarbeiros()
popularSelectsBarbeiro()

})

// =========================
// SYNC CONFIG
// =========================

DB.config.on("value",snap=>{

if(snap.exists()){
config=snap.val()
cfgAbertura.value=config.abertura
cfgFechamento.value=config.fechamento
cfgIntervalo.value=config.intervalo
}else{
DB.config.set(config)
}

})

// =========================
// SYNC AGENDAMENTOS
// =========================

DB.ag.on("value",snap=>{

agendamentos = snap.exists()? Object.values(snap.val()) : []

renderAdminAgendamentos()

if(barbeiroSel && dataSel){
renderHorariosCliente()
}

})

// =========================
// SYNC DISPONIBILIDADE
// =========================

DB.disp.on("value",snap=>{

disponibilidade = snap.exists()? snap.val() : {}

if(barbeiroSel){
renderDatasCliente()
}

renderResetDias()

})

// =========================
// ADMIN RENDERS
// =========================

function renderAdminServicos(){

adminServicos.innerHTML=""

servicos.forEach((s,i)=>{

let div=document.createElement("div")
div.className="card card-sub"

div.innerHTML=`
<b>${s.nome}</b> ‚Äî R$ ${s.preco}
<br><br>
<button class="btn-outline" onclick="removerServico(${i})">
Remover
</button>
`

adminServicos.appendChild(div)

})

}

function renderAdminBarbeiros(){

adminBarbeiros.innerHTML=""

barbeiros.forEach((b,i)=>{

let div=document.createElement("div")
div.className="card card-sub"

div.innerHTML=`
<b>${b}</b>
<br><br>
<button class="btn-outline" onclick="removerBarbeiro(${i})">
Remover
</button>
`

adminBarbeiros.appendChild(div)

})

}

function renderAdminAgendamentos(){

listaAgendamentos.innerHTML=""

agendamentos
.sort((a,b)=>(a.data+a.hora).localeCompare(b.data+b.hora))
.forEach(a=>{

let div=document.createElement("div")
div.className="card card-sub"

div.innerHTML=`
<span class="badge">${a.data} ${a.hora}</span>
<br><br>
${a.servico} ‚Äî ${a.barbeiro}
<br>
Cliente: ${a.cliente}
<br>
Whats: ${a.fone}
`

listaAgendamentos.appendChild(div)

})

}

// =========================
// CRUD SERVI√áOS
// =========================

btnAddServico.onclick=()=>{

if(!novoServicoNome.value || !novoServicoPreco.value) return

servicos.push({
nome:novoServicoNome.value,
preco:Number(novoServicoPreco.value)
})

DB.servicos.set(servicos)

novoServicoNome.value=""
novoServicoPreco.value=""

}

function removerServico(i){

if(!confirm("Remover servi√ßo?")) return

servicos.splice(i,1)
DB.servicos.set(servicos)

}

// =========================
// CRUD BARBEIROS
// =========================

btnAddBarbeiro.onclick=()=>{

if(!novoBarbeiro.value) return

barbeiros.push(novoBarbeiro.value)
DB.barbeiros.set(barbeiros)

novoBarbeiro.value=""

}

function removerBarbeiro(i){

if(!confirm("Remover barbeiro?")) return

barbeiros.splice(i,1)
DB.barbeiros.set(barbeiros)

}

// =========================
// SALVAR CONFIG
// =========================

btnSalvarCfg.onclick=()=>{

if(!confirm("Salvar configura√ß√£o base?")) return

config={
abertura:cfgAbertura.value,
fechamento:cfgFechamento.value,
intervalo:Number(cfgIntervalo.value)
}

DB.config.set(config)

alert("Configura√ß√£o salva ‚úÖ")

}

// =========================
// EXPORTAR AGENDA
// =========================

btnExportarDia.onclick=()=>{

let hoje=hojeISO()

let lista=agendamentos.filter(a=>a.data===hoje)

let txt=`AGENDA ${NOME_BARBEARIA} ‚Äî ${hoje}\n\n`

lista.forEach(a=>{
txt+=`${a.hora} ‚Äî ${a.cliente} ‚Äî ${a.servico}\n`
})

navigator.clipboard.writeText(txt)
alert("Agenda copiada ‚úÖ")

}

// =========================
// SETUP
// =========================

btnSetup.onclick=()=>{

let nome=prompt("Nome da barbearia:")

if(nome){
NOME_BARBEARIA=nome.toUpperCase()
aplicarNome()
}

alert("Setup aplicado")

}

// =========================
// DEMO
// =========================

btnDemo.onclick=()=>{

DB.ag.push({
servico:"Corte",
preco:40,
barbeiro:"Carlos",
data:hojeISO(),
hora:"10:00",
cliente:"Demo",
fone:"11999999999",
ts:Date.now()
})

alert("Demo criado")

}

// =========================
// SERVICE WORKER
// =========================

if("serviceWorker" in navigator){
navigator.serviceWorker.register("sw.js")
}

// =========================
// LOG FINAL
// =========================

console.log("üíà BARBARUJO ‚Äî PROJETO FINAL UX ATIVO")

</script>

</div>
</body>
</html>
